(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["app~fa1e48bf"],{

/***/ "iVgR":
/*!**********************************!*\
  !*** ./src/gameCode/BaseGame.js ***!
  \**********************************/
/*! exports provided: setupIgor */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"setupIgor\", function() { return setupIgor; });\n/* harmony import */ var IgorJs_main__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! IgorJs/main */ \"7jDb\");\n/* harmony import */ var Config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! Config */ \"463H\");\n/* harmony import */ var gameCode_PlayerWorkshop__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! gameCode/PlayerWorkshop */ \"Kh/G\");\n/* harmony import */ var gameCode_GameObjects__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! gameCode/GameObjects */ \"iVpH\");\n/* harmony import */ var gameCode_inventory_Igor__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! gameCode/inventory_Igor */ \"uH5N\");\n/* harmony import */ var gameCode_FactoryBlocks__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! gameCode/FactoryBlocks */ \"v3/l\");\n\n\n\n\n\n //* these two setup the base game data,\n// possibly combine them to a single function\n//\n\nvar newGame = {\n  land: {\n    total: 100,\n    used: 0,\n    complexity: 0,\n    res_patches: 1,\n    res_patches_used: 0,\n    fac_block_costs: {\n      factory: 100,\n      bus: 100,\n      research: 100\n    }\n  },\n  scanning: {\n    nextCost: 100,\n    currentCost: 0\n  },\n  attackWaves: {\n    nextTimer: 100,\n    nextStrength: 100,\n    currentTimer: 0\n  },\n  facBlocks: {\n    defenses: null,\n    defenseBus: null,\n    offense: null,\n    offenseBus: null,\n    resBlocks: [],\n    buses: [],\n    blocks: [],\n    techBlocks: []\n  },\n  player: gameCode_PlayerWorkshop__WEBPACK_IMPORTED_MODULE_2__[\"newPlayer\"],\n  activeFeatures: {\n    tutorial: true\n  },\n  research: {\n    completed: {},\n    progressing: null\n  },\n  unlocked_recipes: [],\n  version: Config__WEBPACK_IMPORTED_MODULE_1__[\"IDB_SAVE_VERSION\"]\n};\nIgorJs_main__WEBPACK_IMPORTED_MODULE_0__[\"IgorUtils\"].defineObj(\"#\", newGame); //* This sets up the references Igor needs to run\n\nvar setupIgor = function setupIgor() {} //TODO rebuild Igor's object list,\n// but ideally it happens automatically \n// when loading game object descriptions\n//IgorJs.defineObj(\"#.facBlocks\", \"factoryBlocksBase\")\n//IgorJs.defineObj(\"player\", \"player\")\n//IgorJs.amendObject(\"FactoryBlocksBase\", {tickFn: (td, obj) => { tickBase(td, obj) } })\n//console.log('setup complete')\n\n/*\r\n//SMELL\r\n//This should be split among the individual objects,\r\n// and probably moved to Function() calls\r\nconst tickBase = (tickData, facBlocks) => {\r\n    if(tickData.ticks%100) { return }\r\n    if(facBlocks?.offenses?.machines.radar?.count) {\r\n      this.globals.scanning.currentCost += facBlocks.offenses.machines.radar.count * 1\r\n      if(this.globals.scanning.currentCost>=this.globals.scanning.nextCost) {\r\n        this.globals.scanning.currentCost -= this.globals.scanning.nextCost\r\n        this.globals.scanning.nextCost += 20\r\n        //NYI generate land /resource patch and enemies\r\n        this.globals.land.total += 10\r\n        this.globals.land.res_patches = Math.floor(this.globals.land.total/100)\r\n\r\n      }\r\n    }\r\n    if(facBlocks?.defenses?.machines.turret?.count) {\r\n      //next wave\r\n      if(this.globals.attackWaves.currentTimer>this.globals.attackWaves.nextTimer) {\r\n        this.globals.attackWaves.nextTimer = this.globals.attackWaves.nextTimer ^ 1.2\r\n        this.globals.attackWaves.currentTime = 0\r\n        //Process some attack\r\n      } else {\r\n        this.globals.attackWaves.currentTimer++\r\n      }\r\n    }\r\n}\r\n*/\n;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaVZnUi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9nYW1lQ29kZS9CYXNlR2FtZS5qcz84OTU4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7SWdvclV0aWxzIGFzIElnb3JKc30gZnJvbSBcIklnb3JKcy9tYWluXCJcclxuaW1wb3J0ICogYXMgQ09ORklHIGZyb20gJ0NvbmZpZydcclxuXHJcbmltcG9ydCAqIGFzIFBsYXllcldvcmtzaG9wIGZyb20gJ2dhbWVDb2RlL1BsYXllcldvcmtzaG9wJ1xyXG5pbXBvcnQgKiBhcyBPYmplY3RzU291cmNlIGZyb20gJ2dhbWVDb2RlL0dhbWVPYmplY3RzJ1xyXG5pbXBvcnQgKiBhcyBJbnZlbnRvcnlJZ29yIGZyb20gJ2dhbWVDb2RlL2ludmVudG9yeV9JZ29yJ1xyXG5pbXBvcnQgKiBhcyBGYWN0b3J5QmxvY2tzIGZyb20gJ2dhbWVDb2RlL0ZhY3RvcnlCbG9ja3MnXHJcblxyXG5cclxuLy8qIHRoZXNlIHR3byBzZXR1cCB0aGUgYmFzZSBnYW1lIGRhdGEsXHJcbi8vIHBvc3NpYmx5IGNvbWJpbmUgdGhlbSB0byBhIHNpbmdsZSBmdW5jdGlvblxyXG4vL1xyXG5jb25zdCBuZXdHYW1lID0ge1xyXG4gICAgbGFuZDoge1xyXG4gICAgICB0b3RhbDogMTAwLFxyXG4gICAgICB1c2VkOiAwLFxyXG4gICAgICBjb21wbGV4aXR5OiAwLFxyXG4gICAgICByZXNfcGF0Y2hlczogMSxcclxuICAgICAgcmVzX3BhdGNoZXNfdXNlZDogMCxcclxuICAgICAgZmFjX2Jsb2NrX2Nvc3RzOiB7XHJcbiAgICAgICAgZmFjdG9yeTogMTAwLFxyXG4gICAgICAgIGJ1czogMTAwLFxyXG4gICAgICAgIHJlc2VhcmNoOiAxMDAsXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBzY2FubmluZzoge1xyXG4gICAgICBuZXh0Q29zdDogMTAwLFxyXG4gICAgICBjdXJyZW50Q29zdDogMFxyXG4gICAgfSxcclxuICAgIGF0dGFja1dhdmVzOiB7XHJcbiAgICAgIG5leHRUaW1lcjogMTAwLFxyXG4gICAgICBuZXh0U3RyZW5ndGg6IDEwMCxcclxuICAgICAgY3VycmVudFRpbWVyOiAwLFxyXG4gICAgfSxcclxuICAgIGZhY0Jsb2Nrczoge1xyXG4gICAgICBkZWZlbnNlczogbnVsbCxcclxuICAgICAgZGVmZW5zZUJ1czogbnVsbCxcclxuICAgICAgb2ZmZW5zZTogbnVsbCxcclxuICAgICAgb2ZmZW5zZUJ1czogbnVsbCxcclxuICAgICAgcmVzQmxvY2tzOiBbXSxcclxuICAgICAgYnVzZXM6IFtdLFxyXG4gICAgICBibG9ja3M6IFtdLFxyXG4gICAgICB0ZWNoQmxvY2tzOiBbXVxyXG4gICAgfSxcclxuICAgIHBsYXllcjogUGxheWVyV29ya3Nob3AubmV3UGxheWVyLFxyXG4gICAgYWN0aXZlRmVhdHVyZXM6IHtcclxuICAgICAgdHV0b3JpYWw6IHRydWVcclxuICAgIH0sXHJcbiAgICByZXNlYXJjaDogeyBjb21wbGV0ZWQ6IHt9LCBwcm9ncmVzc2luZzogbnVsbCB9LFxyXG4gICAgdW5sb2NrZWRfcmVjaXBlczogW10sXHJcbiAgICB2ZXJzaW9uOiBDT05GSUcuSURCX1NBVkVfVkVSU0lPTlxyXG59XHJcbklnb3JKcy5kZWZpbmVPYmooXCIjXCIsIG5ld0dhbWUpXHJcblxyXG5cclxuLy8qIFRoaXMgc2V0cyB1cCB0aGUgcmVmZXJlbmNlcyBJZ29yIG5lZWRzIHRvIHJ1blxyXG5leHBvcnQgY29uc3Qgc2V0dXBJZ29yID0gKCkgPT4ge1xyXG4gIC8vVE9ETyByZWJ1aWxkIElnb3IncyBvYmplY3QgbGlzdCxcclxuICAvLyBidXQgaWRlYWxseSBpdCBoYXBwZW5zIGF1dG9tYXRpY2FsbHkgXHJcbiAgLy8gd2hlbiBsb2FkaW5nIGdhbWUgb2JqZWN0IGRlc2NyaXB0aW9uc1xyXG4gIC8vSWdvckpzLmRlZmluZU9iaihcIiMuZmFjQmxvY2tzXCIsIFwiZmFjdG9yeUJsb2Nrc0Jhc2VcIilcclxuICAvL0lnb3JKcy5kZWZpbmVPYmooXCJwbGF5ZXJcIiwgXCJwbGF5ZXJcIilcclxuICAvL0lnb3JKcy5hbWVuZE9iamVjdChcIkZhY3RvcnlCbG9ja3NCYXNlXCIsIHt0aWNrRm46ICh0ZCwgb2JqKSA9PiB7IHRpY2tCYXNlKHRkLCBvYmopIH0gfSlcclxuICAvL2NvbnNvbGUubG9nKCdzZXR1cCBjb21wbGV0ZScpXHJcbn1cclxuXHJcbi8qXHJcbi8vU01FTExcclxuLy9UaGlzIHNob3VsZCBiZSBzcGxpdCBhbW9uZyB0aGUgaW5kaXZpZHVhbCBvYmplY3RzLFxyXG4vLyBhbmQgcHJvYmFibHkgbW92ZWQgdG8gRnVuY3Rpb24oKSBjYWxsc1xyXG5jb25zdCB0aWNrQmFzZSA9ICh0aWNrRGF0YSwgZmFjQmxvY2tzKSA9PiB7XHJcbiAgICBpZih0aWNrRGF0YS50aWNrcyUxMDApIHsgcmV0dXJuIH1cclxuICAgIGlmKGZhY0Jsb2Nrcz8ub2ZmZW5zZXM/Lm1hY2hpbmVzLnJhZGFyPy5jb3VudCkge1xyXG4gICAgICB0aGlzLmdsb2JhbHMuc2Nhbm5pbmcuY3VycmVudENvc3QgKz0gZmFjQmxvY2tzLm9mZmVuc2VzLm1hY2hpbmVzLnJhZGFyLmNvdW50ICogMVxyXG4gICAgICBpZih0aGlzLmdsb2JhbHMuc2Nhbm5pbmcuY3VycmVudENvc3Q+PXRoaXMuZ2xvYmFscy5zY2FubmluZy5uZXh0Q29zdCkge1xyXG4gICAgICAgIHRoaXMuZ2xvYmFscy5zY2FubmluZy5jdXJyZW50Q29zdCAtPSB0aGlzLmdsb2JhbHMuc2Nhbm5pbmcubmV4dENvc3RcclxuICAgICAgICB0aGlzLmdsb2JhbHMuc2Nhbm5pbmcubmV4dENvc3QgKz0gMjBcclxuICAgICAgICAvL05ZSSBnZW5lcmF0ZSBsYW5kIC9yZXNvdXJjZSBwYXRjaCBhbmQgZW5lbWllc1xyXG4gICAgICAgIHRoaXMuZ2xvYmFscy5sYW5kLnRvdGFsICs9IDEwXHJcbiAgICAgICAgdGhpcy5nbG9iYWxzLmxhbmQucmVzX3BhdGNoZXMgPSBNYXRoLmZsb29yKHRoaXMuZ2xvYmFscy5sYW5kLnRvdGFsLzEwMClcclxuXHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmKGZhY0Jsb2Nrcz8uZGVmZW5zZXM/Lm1hY2hpbmVzLnR1cnJldD8uY291bnQpIHtcclxuICAgICAgLy9uZXh0IHdhdmVcclxuICAgICAgaWYodGhpcy5nbG9iYWxzLmF0dGFja1dhdmVzLmN1cnJlbnRUaW1lcj50aGlzLmdsb2JhbHMuYXR0YWNrV2F2ZXMubmV4dFRpbWVyKSB7XHJcbiAgICAgICAgdGhpcy5nbG9iYWxzLmF0dGFja1dhdmVzLm5leHRUaW1lciA9IHRoaXMuZ2xvYmFscy5hdHRhY2tXYXZlcy5uZXh0VGltZXIgXiAxLjJcclxuICAgICAgICB0aGlzLmdsb2JhbHMuYXR0YWNrV2F2ZXMuY3VycmVudFRpbWUgPSAwXHJcbiAgICAgICAgLy9Qcm9jZXNzIHNvbWUgYXR0YWNrXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5nbG9iYWxzLmF0dGFja1dhdmVzLmN1cnJlbnRUaW1lcisrXHJcbiAgICAgIH1cclxuICAgIH1cclxufVxyXG4qLyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQU5BO0FBWUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUkE7QUFVQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQXRDQTtBQXdDQTtBQUNBO0FBR0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQVZBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///iVgR\n");

/***/ }),

/***/ "v3/l":
/*!***************************************!*\
  !*** ./src/gameCode/FactoryBlocks.js ***!
  \***************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var IgorJs_main__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! IgorJs/main */ \"7jDb\");\n/* harmony import */ var Chameleon_main__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! Chameleon/main */ \"6juG\");\n/* harmony import */ var minimatch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! minimatch */ \"2LKJ\");\n/* harmony import */ var minimatch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(minimatch__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\nIgorJs_main__WEBPACK_IMPORTED_MODULE_0__[\"IgorUtils\"].setStatic(\"itemStackCost.busExpansion\", [{\n  name: \"iron-chest\",\n  count: 2\n}]);\nIgorJs_main__WEBPACK_IMPORTED_MODULE_0__[\"IgorUtils\"].setStatic(\"itemStackCost.busProcessing\", [{\n  name: \"inserter\",\n  count: 2\n}]);\nIgorJs_main__WEBPACK_IMPORTED_MODULE_0__[\"IgorUtils\"].setStatic(\"itemStackCost.resBlock_foundation\", [{\n  name: \"stone\",\n  count: 5\n}, {\n  name: \"transport-belt\",\n  count: 4\n}]);\nIgorJs_main__WEBPACK_IMPORTED_MODULE_0__[\"IgorUtils\"].setStatic(\"itemStackCost.resBlock_miner\", [{\n  name: \"burner-mining-drill\",\n  count: 1\n}]);\nvar FactoryBlock = {};\n\nFactoryBlock.New = function (params, newObj, Igor) {\n  var features = Igor.getNamedObject(\"global\").activeFeatures.factoryBlocks;\n  newObj.name = params.name.string;\n  newObj.size = 50;\n  newObj.complexity = 10;\n  newObj.connections = {\n    sources: [],\n    drains: [],\n    maxSources: features.blocksMaxSources || 1,\n    maxDrains: features.blocksMaxDrains || 1\n  };\n  var bufferSettings = {\n    restrictable: true,\n    stacks: 1,\n    stackSize: 10\n  };\n  newObj.buffers = {};\n  newObj.buffers.in = Igor.newComponent(\"entity.buffer\", bufferSettings, newObj);\n  newObj.buffers.internal = Igor.newComponent(\"entity.buffer\", bufferSettings, newObj);\n  newObj.buffers.out = Igor.newComponent(\"entity.buffer\", bufferSettings, newObj);\n  newObj.processingList = {};\n  newObj.subIcon = \"stone\";\n  newObj.factoryLines = [];\n  newObj.factoryLines.push(Igor.newComponent(\"FactoryLine\", {\n    source: newObj.buffers.in,\n    drain: newObj.buffers.out,\n    internal: newObj.buffers.internal,\n    parent: newObj.$_id,\n    order: newObj.factoryLines.length\n  }));\n  newObj.$_tags.push(\"tick\", \"processing\");\n  return [newObj];\n};\n\nFactoryBlock.New.signature = {};\nFactoryBlock.New._signal = \"facBlockUpdate\";\n\nFactoryBlock.NewCCC = function (params, Igor) {\n  Igor.addNewObject(Igor.getNamedObject(\"global\").facBlocks.blocks, \"FactoryBlock\", params);\n};\n\nFactoryBlock.NewCCC.signature = {\n  name: \"string\"\n};\nFactoryBlock.NewCCC.CC_provide = \"facBlock.newBlock\";\n\nFactoryBlock.NewBusCCC = function (params, Igor) {\n  Igor.addNewObject(Igor.getNamedObject(\"global\").facBlocks.buses, \"FactoryBus\", params);\n};\n\nFactoryBlock.NewBusCCC.signature = {\n  name: \"string\"\n};\nFactoryBlock.NewBusCCC.CC_provide = \"facBlock.newBus\";\n\nFactoryBlock.NewResBlock = function (params, Igor) {\n  if (Igor.addNewObject(Igor.getNamedObject(\"global\").facBlocks.resBlocks, \"ResourceBlock\", params)) {\n    Igor.getNamedObject(\"global\").land.res_patches_used++;\n  }\n};\n\nFactoryBlock.NewResBlock.signature = {\n  name: \"string\" //WIP should become resource vein\n\n};\nFactoryBlock.NewResBlock.CC_provide = \"facBlock.newResBlock\";\n\nFactoryBlock.NewTechBlock = function (params, Igor) {\n  Igor.addNewObject(Igor.getNamedObject(\"global\").facBlocks.techBlocks, \"TechBlock\", params);\n};\n\nFactoryBlock.NewTechBlock.signature = {\n  name: \"string\"\n};\nFactoryBlock.NewTechBlock.CC_provide = \"facBlock.newTechBlock\";\n\nFactoryBlock.__tooltips = function (obj, args, retObj, Igor) {\n  var who = Igor.getId(obj) || null;\n  var data = [];\n  var tip = \"\";\n\n  switch (args.which) {\n    case \"resBlock\":\n      data.landCost = \"resource\";\n      data.complexity = 5;\n      tip = \"Next ResourceBlock\";\n      break;\n\n    case \"techBlock\":\n      data.landCost = 50;\n      data.complexity = 5;\n      tip = \"Next Tech Block\";\n      break;\n\n    case \"busLine\":\n      data.landCost = 25;\n      data.complexity = 5;\n      tip = \"Next Bus Line\";\n      break;\n\n    case \"factoryBlock\":\n      data.landCost = 50;\n      data.complexity = 10;\n      tip = \"Next Factory Block\";\n      break;\n\n    case \"addLine\":\n      tip = \"New Factory Line\";\n      break;\n  }\n\n  retObj._result = {\n    tool: \"blockCosts\",\n    tip: tip,\n    data: data\n  };\n};\n\nFactoryBlock.__tooltips.CC_utility = \"facBlock.__tooltips\";\n\nFactoryBlock.tick = function (obj, tickData, Igor) {\n  // Process I/O buffers\n  if (obj.connections.drains) {//console.log('process drains: push mode')\n  }\n};\n\nFactoryBlock.tick.signature = {};\n\nFactoryBlock.SelectSubIcon = function (obj, params, Igor) {\n  obj.at.factoryBlock.subIcon = obj.which.icon;\n};\n\nFactoryBlock.SelectSubIcon.signature = {\n  at: \"factoryBlock\",\n  which: \"icon\"\n};\nFactoryBlock.SelectSubIcon.CC_provide = \"factoryBlock.selectSubIcon\";\n\nFactoryBlock.ConsumeStacks = function (target, args, returnObj, Igor) {\n  //WIP\n  var consumable = args.itemStacks.reduce(function (accum_multi, x) {\n    if (accum_multi == -1) return -1;\n    var avail = Igor.processTEMP(Igor.getId(target.processingList[x.name].at).items, \"inventory.total\", {\n      name: x.name\n    });\n    return avail < x.amount ? -1 : Math.min(accum_multi, Math.floor(avail / x.amount));\n  }, args.multi);\n\n  if (consumable >= 1) {\n    args.itemStacks.forEach(function (x) {\n      Igor.processTEMP(Igor.getId(target.processingList[x.name].at), \"inventory.consume\", {\n        itemStacks: x,\n        multi: consumable\n      });\n    });\n  }\n\n  returnObj._result = consumable;\n};\n\nFactoryBlock.ConsumeStacks.signature = {};\nFactoryBlock.ConsumeStacks.Igor_operation = \"factoryBlock.consumeStacks\";\n\nFactoryBlock.ProduceStacks = function (target, args, returnObj, Igor) {\n  var depositable = args.itemStacks.reduce(function (accum_multi, x) {\n    if (accum_multi == -1) return -1; //Shortcircuit\n\n    var buffer = Igor.getId(target.processingList[x.name].at);\n    var avail = buffer.stackSize - Igor.processTEMP(buffer.items, \"inventory.total\", {\n      name: x.name\n    });\n    return avail < x.amount ? -1 : Math.min(accum_multi, Math.floor(avail / x.amount));\n  }, args.multi);\n\n  if (depositable >= 1) {\n    args.itemStacks.forEach(function (x) {\n      Igor.processTEMP(Igor.getId(target.processingList[x.name].at), \"inventory.add\", {\n        itemStacks: x,\n        multi: depositable\n      });\n    });\n  }\n\n  returnObj._result = depositable;\n};\n\nFactoryBlock.ProduceStacks.signature = {};\nFactoryBlock.ProduceStacks.Igor_operation = \"factoryBlock.produceStacks\";\n\nFactoryBlock.SetConnection = function (obj, Igor) {\n  var callFn = obj.dir.string == \"source\" ? \"Drain\" : \"Source\";\n\n  if (obj.at.factoryBlock.connections[obj.dir.string + 's'] == obj.to_which.factoryBus) {\n    Igor.processTEMP(obj.to_which.factoryBus, \"factoryBus.clear\" + callFn, {\n      who: obj.at.factoryBlock.$_id\n    });\n    return;\n  } //Clear prior connection\n  //Can execute on factoryBus...\n\n\n  if (Igor.processTEMP(obj.to_which.factoryBus, \"factoryBus.add\" + callFn, {\n    who: obj.at.factoryBlock.$_id\n  })) {\n    obj.at.factoryBlock.connections[obj.dir.string + 's'] = obj.to_which.factoryBus;\n  }\n\n  Igor.processTEMP(obj.to_which.factoryBus, \"factoryBus.connectTo\", {});\n};\n\nFactoryBlock.SetConnection.signature = {\n  at: \"factoryBlock\",\n  to_which: \"factoryBus\",\n  dir: \"string\"\n};\nFactoryBlock.SetConnection.CC_provide = \"factoryBlock.setConnection\";\n\nFactoryBlock.AddFactoryLine = function (obj, Igor) {\n  // obj.at.factoryBlock.complexity\n  // Inventory.consume some cost\n  obj.at.factoryBlock.factoryLines.push(Igor.newComponent(\"FactoryLine\", {\n    source: obj.at.factoryBlock.buffers.in,\n    drain: obj.at.factoryBlock.buffers.out,\n    internal: obj.at.factoryBlock.buffers.internal,\n    parent: obj.at.factoryBlock.$_id,\n    order: obj.at.factoryBlock.factoryLines.length || 0\n  })); // obj.at.factoryBlock.complexity++\n\n  Igor.view.signaler.signal(\"generalUpdate\");\n};\n\nFactoryBlock.AddFactoryLine.signature = {\n  at: \"factoryBlock\"\n};\nFactoryBlock.AddFactoryLine.CC_provide = \"factoryBlock.addLine\";\n\nFactoryBlock.SetProcessItems = function (target, args, returnObj, Igor) {\n  console.log('set process');\n  args.lists.consume.forEach(function (x) {\n    if (!target.processingList[x]) {\n      target.processingList[x] = {\n        at: target.buffers.in,\n        consume: [args.listId]\n      };\n    } else if (target.processingList[x].at == target.buffers.internal) {\n      target.processingList[x].consume.push(args.listId);\n    } else if (target.processingList[x].at == target.buffers.out) {\n      // Move to internal\n      target.processingList[x].at = target.buffers.internal;\n      target.processingList[x].consume = [];\n      target.processingList[x].consume.push(args.listId);\n    } else {//x is found and at input already\n    }\n  });\n  args.lists.produce.forEach(function (x) {\n    if (!target.processingList[x]) {\n      target.processingList[x] = {\n        at: target.buffers.out,\n        produce: [args.listId]\n      };\n    } else if (target.processingList[x].at == target.buffers.internal) {\n      target.processingList[x].produce.push(args.listId);\n    } else if (target.processingList[x].at == target.buffers.in) {\n      //move it\n      target.processingList[x].at = target.buffers.internal;\n      target.processingList[x].produce = [];\n      target.processingList[x].produce.push(args.listId);\n    }\n  }); //TODO this doesn't respect stack limits on the buffers\n\n  Igor.processTEMP(target.buffers.in, \"buffer.restrictList\", {\n    list: Object.keys(target.processingList).filter(function (x) {\n      return target.processingList[x].at == target.buffers.in;\n    })\n  });\n  Igor.processTEMP(target.buffers.internal, \"buffer.restrictList\", {\n    list: Object.keys(target.processingList).filter(function (x) {\n      return target.processingList[x].at == target.buffers.internal;\n    })\n  });\n  Igor.processTEMP(target.buffers.out, \"buffer.restrictList\", {\n    list: Object.keys(target.processingList).filter(function (x) {\n      return target.processingList[x].at == target.buffers.out;\n    })\n  });\n};\n\nFactoryBlock.SetProcessItems.Igor_operation = \"factoryBlock.setProcessItems\";\n\nFactoryBlock.ClearProcessItems = function (target, args, returnObj, Igor) {\n  args.lists.consume.forEach(function (x) {\n    var which = target.processingList[x];\n    which.consume.splice(which.consume.indexOf(args.listId), 1);\n\n    if (which.consume.length == 0) {\n      var _which$produce;\n\n      if (which.at == target.buffers.internal && ((_which$produce = which.produce) == null ? void 0 : _which$produce.length) > 0) {\n        which.at = target.buffers.out;\n      } else {\n        delete target.processingList[x];\n      }\n    }\n  });\n  args.lists.produce.forEach(function (x) {\n    var which = target.processingList[x];\n    which.produce.splice(which.produce.indexOf(args.listId), 1);\n\n    if (which.produce.length == 0) {\n      var _which$consume;\n\n      if (which.at == target.buffers.internal && ((_which$consume = which.consume) == null ? void 0 : _which$consume.length) > 0) {\n        which.at = target.buffers.in;\n      } else {\n        delete target.processingList[x];\n      }\n    }\n  });\n  Igor.processTEMP(Igor.getId(target.buffers.in), \"buffer.restrictList\", {\n    list: Object.keys(target.processingList).filter(function (x) {\n      return target.processingList[x].at == \"in\";\n    })\n  });\n  Igor.processTEMP(Igor.getId(target.buffers.internal), \"buffer.restrictList\", {\n    list: Object.keys(target.processingList).filter(function (x) {\n      return target.processingList[x].at == \"internal\";\n    })\n  });\n  Igor.processTEMP(Igor.getId(target.buffers.out), \"buffer.restrictList\", {\n    list: Object.keys(target.processingList).filter(function (x) {\n      return target.processingList[x].at == \"out\";\n    })\n  });\n};\n\nFactoryBlock.ClearProcessItems.Igor_operation = \"factoryBlock.clearProcessItems\";\nIgorJs_main__WEBPACK_IMPORTED_MODULE_0__[\"IgorUtils\"].defineObj(\"FactoryBlock\", FactoryBlock.New, FactoryBlock);\n/*\r\n    Factory Line\r\n*/\n\nvar FactoryLine = {};\n\nFactoryLine.New = function (params, newObj, Igor) {\n  newObj.prepped = 0;\n  newObj.built = 0;\n  newObj.buildingType = null;\n  newObj.recipe = null;\n  newObj.itemTargets = null;\n  newObj.processing_time = -1;\n  newObj.connections = {\n    source: params.source,\n    drain: params.drain,\n    internal: params.internal\n  };\n  newObj.order = params.order;\n  newObj.$_parent = params.parent;\n  return [newObj];\n};\n\nFactoryLine.New.signature = {\n  source: 'entity.buffer',\n  drain: 'entity.buffer',\n  internal: 'entity.buffer'\n};\nFactoryLine.New._signal = \"facBlockUpdate\";\n\nFactoryLine.__delete = function (obj, Igor) {\n  console.log('got it!');\n};\n\nFactoryLine.__delete.Igor_operation = \"FactoryLine.delete\";\n\nFactoryLine.SetType = function (obj, Igor) {\n  obj.at.factoryLine.buildingType = obj.which.building.name;\n  obj.at.factoryLine.crafting_categories = obj.which.building.crafting_categories; //Create Lookup by building type\n\n  obj.at.factoryLine.foundationCost = [{\n    name: \"stone\",\n    count: 5\n  }];\n};\n\nFactoryLine.SetType.signature = {\n  at: [\"factoryLine\", \"factoryBlock\"],\n  which: \"building\"\n};\nFactoryLine.SetType.CC_provide = \"factoryLine.setBuilding\";\n\nFactoryLine.Prep = function (obj, Igor) {\n  if (!obj.at.factoryLine.foundationCost) return;\n\n  if (Igor.processTEMP(obj.player.inventory, \"inventory.consume\", {\n    itemStacks: obj.at.factoryLine.foundationCost\n  })) {\n    obj.at.factoryLine.prepped++;\n    obj.at.factoryBlock.size += 10; //# magic number\n\n    obj.at.factoryBlock.complexity += 5; //# magic number\n  } else {\n    console.error(\"Cannot consume foundation costs\");\n  }\n};\n\nFactoryLine.Prep.signature = {\n  at: [\"factoryLine\", \"factoryBlock\"],\n  player: \"inventory\"\n};\nFactoryLine.Prep.CC_provide = \"factoryLine.prep\";\n\nFactoryLine.Expand = function (obj, Igor) {\n  if (obj.at.factoryLine.prepped == 0) return;\n\n  if (Igor.processTEMP(obj.player.inventory, \"inventory.consume\", {\n    itemStacks: {\n      name: obj.at.factoryLine.buildingType,\n      count: 1\n    }\n  })) {\n    if (obj.at.factoryLine.prepped > 0\n    /* && inventory.consume */\n    ) {\n        obj.at.factoryLine.built++;\n        obj.at.factoryLine.prepped--;\n\n        if (obj.at.factoryLine.recipe) {\n          if (Number.isInteger(obj.at.factoryLine.processing_ticks)) {\n            //If we're already actively processing something...\n            //console.log('currently processing '+obj.at.factoryLine.processing_count)\n            //console.log('ticks: '+obj.at.factoryLine.processing_ticks)\n            //console.log('timer: '+obj.at.factoryLine.processing_time)\n            var consumed = Igor.processTEMP(obj.at.factoryBlock, \"factoryBlock.consumeStacks\", {\n              itemStacks: obj.at.factoryLine.recipe.ingredients,\n              multi: 1\n            });\n\n            if (consumed) {\n              obj.at.factoryLine.processing_ticks *= (obj.at.factoryLine.built - 1) / obj.at.factoryLine.built;\n              obj.at.factoryLine.processing_count++; //console.log('new ticks: '+obj.at.factoryLine.processing_ticks)\n            }\n          }\n\n          obj.at.factoryLine.$_tags.push(\"tick\", \"processing\");\n        }\n      }\n  } else {\n    console.error(\"Building not in inventory\");\n  }\n};\n\nFactoryLine.Expand.signature = {\n  at: [\"factoryLine\", \"factoryBlock\"],\n  player: 'inventory'\n};\nFactoryLine.Expand.CC_provide = \"factoryLine.addBuilding\";\n/*\r\n*/\n\nFactoryLine.SetRecipe = function (obj, Igor) {\n  if (obj.at.factoryLine.recipe) {\n    if (obj.at.factoryLine.recipe !== obj.which.recipe) {\n      Igor.processTEMP(obj.at.factoryBlock, \"factoryBlock.clearProcessItems\", {\n        lists: obj.at.factoryLine.processList\n      });\n    } else {\n      obj.at.factoryLine.recipe = null;\n      obj.at.factoryLine.$_tags.delete(\"tick\");\n      return;\n    }\n  }\n\n  var recipe = Igor.data.recipe[obj.which.recipe];\n  var lists = {\n    consume: recipe.ingredients.map(function (x) {\n      return x.name;\n    }),\n    produce: recipe.results.map(function (x) {\n      return x.name;\n    })\n  };\n  var FB_set = Igor.processTEMP(obj.at.factoryBlock, \"factoryBlock.setProcessItems\", {\n    lists: lists,\n    listId: obj.at.factoryLine.$_id\n  });\n\n  if (FB_set) {\n    obj.at.factoryLine.processList = lists;\n    obj.at.factoryLine.recipe = recipe; // store full object, not argument from obj.which.recipe\n\n    obj.at.factoryLine.processing_time = recipe.crafting_speed / Igor.data.entity[obj.at.factoryLine.buildingType].crafting_speed * Igor.getStatic(\"config.TICKS_PER_SECOND\");\n    obj.at.factoryLine.processing_ticks = NaN;\n    obj.at.factoryLine.built && obj.at.factoryLine.$_tags.push(\"tick\", \"processing\"); //Just wait till next tick to start processing the recipe\n  } else {\n    // Factory Block set failed...\n    console.error(\"Couldn't set my items on the parent factoryBlock\");\n    debugger;\n  }\n};\n\nFactoryLine.SetRecipe.signature = {\n  at: [\"factoryLine\", \"factoryBlock\"],\n  which: \"recipe\",\n  player: \"inventory\"\n};\nFactoryLine.SetRecipe.CC_provide = \"factoryLine.setRecipe\";\n\nFactoryLine.__tooltips = function (obj, args, ret, Igor) {\n  var who = Igor.getId(obj);\n  var data = [];\n  var tip = \"\";\n\n  switch (args.which) {\n    case \"foundation\":\n      data.push({\n        name: \"stone\",\n        count: 5\n      });\n      tip = \"Foundation Cost\";\n      break;\n  }\n\n  ret._result = {\n    tool: \"stackArray\",\n    tip: tip,\n    data: data\n  };\n};\n\nFactoryLine.__tooltips.CC_utility = \"factoryLine.toolTips\";\n\nFactoryLine.tick = function (entity, tickdata, Igor) {\n  if (entity.built == 0 || !entity.processing_time || !entity.recipe) return; //TODO turn this into an \"anti-tick\" tag\n  //consume from buffers if empty\n\n  if (entity.delay) {\n    if (--entity.delay == 0) {\n      entity.delay = null;\n    }\n\n    return;\n  }\n\n  if (Number.isNaN(entity.processing_ticks)) {\n    var consumed = Igor.processTEMP(entity.$_parent, \"factoryBlock.consumeStacks\", {\n      itemStacks: entity.recipe.ingredients,\n      multi: entity.built\n    });\n\n    if (consumed > 0) {\n      entity.processing_ticks = 0;\n      entity.processing_count = consumed;\n    } else {\n      entity.delay = Math.ceil(entity.processing_time * 0.1);\n    }\n  } else if (entity.processing_ticks >= entity.processing_time) {\n    var added = Igor.processTEMP(entity.$_parent, \"factoryBlock.produceStacks\", {\n      itemStacks: entity.recipe.results,\n      multi: entity.processing_count\n    });\n\n    if (added > 0) {\n      entity.processing_ticks = NaN;\n    } else {\n      // Couldn't deposit all so... try again after a delay\n      entity.delay = Math.ceil(entity.processing_time * 0.1);\n    }\n  } else {\n    entity.processing_ticks++;\n  }\n};\n\nIgorJs_main__WEBPACK_IMPORTED_MODULE_0__[\"IgorUtils\"].defineObj(\"FactoryLine\", FactoryLine.New, FactoryLine);\n/**\r\n *  * Factory Bus\r\n *  TODO: source/drains are managed from factoryBlocks\r\n *  TODO: Ticker to move things between buffers\r\n *  TODO: Upgrades and expansions\r\n * \r\n */\n\nvar FactoryBus = {};\n\nFactoryBus.New = function (params, newObj, Igor) {\n  newObj.name = params.name.string;\n  newObj.size = 25;\n  newObj.complexity = 5;\n  newObj.connections = {\n    sources: [],\n    drains: [],\n    maxSources: 0,\n    maxDrains: 0\n  };\n  newObj.processors = {\n    source: {\n      xferTicks: 120,\n      xferTimer: 0,\n      xferTarget: 0,\n      xferQty: 0\n    },\n    drain: {\n      xferTicks: 120,\n      xferTimer: 0,\n      xferTarget: 0,\n      xferQty: 0\n    },\n    central: Igor.newComponent(\"entity.buffer\", {\n      stacks: 1,\n      stackSize: 10\n    }, newObj.$_id)\n  };\n  newObj.clogged = false;\n  newObj.subIcon = \"stone\"; // newObj.$_tags.push(\"tick\", \"processing\")\n\n  return [newObj];\n};\n\nFactoryBus.New._signal = \"facBlockUpdate\";\n\nFactoryBus.SelectSubIcon = function (obj, params, Igor) {\n  obj.at.factoryBus.subIcon = obj.which.icon;\n};\n\nFactoryBus.SelectSubIcon.signature = {\n  at: \"factoryBus\",\n  which: \"icon\"\n};\nFactoryBus.SelectSubIcon.CC_provide = \"factoryBus.selectSubIcon\";\n\nFactoryBus.ClearConnection = function (target, args, returnObj, Igor) {\n  var conn = args.dir == \"sources\" ? \"drains\" : \"sources\";\n  var idx = target.connections[conn].findIndex(function (x) {\n    return x.buffer == args.id;\n  });\n\n  if (idx == -1) {\n    console.log(\"couldn't find index\");\n    debugger;\n  }\n\n  target.connections[conn].splice(idx, 1);\n  target.processors[conn].xferTarget = 0;\n};\n\nFactoryBus.ClearConnection.Igor_operation = \"factoryBus.clearConnection\";\n\nFactoryBus.ConnectTo = function (obj, Igor) {\n  var bus = Igor.getId(obj.connectTo.factoryBus);\n  var block = Igor.getId(obj.connectTo.block);\n\n  if (obj.dir.string == \"output\") {\n    //target drain, bus source\n    if (obj.current.bus != -1 && block.connections.drains.includes(obj.current.bus)) {\n      var idx = block.connections.drains.indexOf(obj.current.bus);\n      block.connections.drains.splice(idx, 1);\n      var curr = Igor.getId(obj.current.bus);\n      idx = curr.connections.sources.indexOf(block.$_id);\n      curr.connections.sources.splice(idx, 1);\n      curr.processors.source.xferTarget = 0;\n    }\n\n    if (block.connections.drains.length < block.connections.maxDrains && bus.connections.sources.length < bus.connections.maxSources) {\n      block.connections.drains.push(obj.connectTo.factoryBus);\n      bus.connections.sources.push(obj.connectTo.block);\n    } else {\n      Igor.view.warnToast(\"No available source connections\");\n    }\n  } else {\n    //target source, bus drain\n    if (obj.current.bus != -1 && block.connections.sources.includes(obj.current.bus)) {\n      var _idx = block.connections.sources.indexOf(obj.current.bus);\n\n      block.connections.sources.splice(_idx, 1);\n\n      var _curr = Igor.getId(obj.current.bus);\n\n      _idx = _curr.connections.drains.indexOf(block.$_id);\n\n      _curr.connections.drains.splice(_idx, 1);\n\n      _curr.processors.drain.xferTarget = 0;\n    }\n\n    if (block.connections.sources.length < block.connections.maxSources && bus.connections.drains.length < bus.connections.maxDrains) {\n      block.connections.sources.push(obj.connectTo.factoryBus);\n      bus.connections.drains.push(obj.connectTo.block);\n    } else {\n      Igor.view.warnToast(\"No available drain connections\");\n    }\n  }\n\n  Igor.view.signaler.signal(\"generalUpdate\");\n};\n\nFactoryBus.ConnectTo.signature = {\n  dir: \"string\",\n  connectTo: [\"factoryBus\", \"block\"],\n  current: \"bus\"\n};\nFactoryBus.ConnectTo.CC_provide = \"factoryBus.connectTo\";\n\nFactoryBus.ExpandBus = function (obj, Igor) {\n  var consumed = Igor.processTEMP(obj.player.inventory, \"inventory.consume\", {\n    itemStacks: Igor.getStatic(\"itemStackCost.busExpansion\")\n  });\n  if (!consumed) return;\n\n  if (obj.dir.string == \"source\") {\n    obj.at.factoryBus.connections.maxSources += 1;\n    obj.at.factoryBus.complexity += 5;\n    obj.at.factoryBus.size += 10;\n  } else if (obj.dir.string == \"drain\") {\n    obj.at.factoryBus.connections.maxDrains += 1;\n    obj.at.factoryBus.size += 10;\n    obj.at.factoryBus.complexity += 5;\n  }\n\n  if (obj.at.factoryBus.connections.maxSources && obj.at.factoryBus.connections.maxDrains) {\n    obj.at.factoryBus.$_tags.push(\"tick\", \"processing\");\n  }\n\n  var central = Igor.getId(obj.at.factoryBus.processors.central);\n  central.maxStacks = Math.min(Math.ceil(obj.at.factoryBus.size / 50), 15);\n};\n\nFactoryBus.ExpandBus.signature = {\n  at: \"factoryBus\",\n  dir: \"string\",\n  player: \"inventory\"\n};\nFactoryBus.ExpandBus.CC_provide = \"factoryBus.expandBus\";\n\nFactoryBus.ExpandProcessing = function (obj, Igor) {\n  var consumed = Igor.processTEMP(obj.player.inventory, \"inventory.consume\", {\n    itemStacks: Igor.getStatic(\"itemStackCost.busProcessing\")\n  });\n  if (!consumed) return;\n\n  if (obj.dir.string == \"source\") {\n    obj.at.factoryBus.processors.source.xferQty += 2;\n    obj.at.factoryBus.size += 10;\n    obj.at.factoryBus.complexity += 5;\n  } else if (obj.dir.string == \"drain\") {\n    obj.at.factoryBus.processors.drain.xferQty += 2;\n    obj.at.factoryBus.size += 10;\n    obj.at.factoryBus.complexity += 5;\n  }\n};\n\nFactoryBus.ExpandProcessing.signature = {\n  at: \"factoryBus\",\n  dir: \"string\",\n  player: \"inventory\"\n};\nFactoryBus.ExpandProcessing.CC_provide = \"factoryBus.expandProcessing\";\n\nFactoryBus.__tooltips = function (obj, args, ret, Igor) {\n  if (!obj) return;\n  var who = Igor.getId(obj);\n  var data = [];\n  var tip = \"\";\n\n  switch (args.which) {\n    case \"input_processing\":\n      data.push({\n        name: \"inserter\",\n        count: 2\n      });\n      tip = \"Input Processing\";\n      break;\n\n    case \"expand_input_sources\":\n      data.push({\n        name: \"iron-chest\",\n        count: 2\n      });\n      who.connections.maxSources && data.push({\n        name: \"transport-belt\",\n        count: 5 * who.connections.maxSources\n      });\n      tip = \"Expand Source Points\";\n      break;\n\n    case \"output_processing\":\n      data.push({\n        name: \"inserter\",\n        count: 2\n      });\n      tip = \"Output Processing\";\n      break;\n\n    case \"expand_output_drains\":\n      data.push({\n        name: \"iron-chest\",\n        count: 2\n      });\n      who.connections.maxDrains && data.push({\n        name: \"transport-belt\",\n        count: 5 * who.connections.maxDrains\n      });\n      tip = \"Expand Drain Points\";\n      break;\n  }\n\n  ret._result = {\n    tool: \"stackArray\",\n    tip: tip,\n    data: data\n  };\n};\n\nFactoryBus.__tooltips.CC_utility = \"busLine_Costs\";\n\nFactoryBus.ClearClog = function (obj, Igor) {\n  Igor.getId(obj.at.factoryBus.processors.central).items.forEach(function (x) {\n    Igor.processTEMP(\"player.inventory\", \"inventory.add\", {\n      itemStacks: x\n    });\n    x.count = 0;\n  });\n};\n\nFactoryBus.ClearClog.signature = {\n  at: \"factoryBus\"\n};\nFactoryBus.ClearClog.CC_provide = \"factoryBus.clearClog\";\n\nFactoryBus.tick = function (entity, tickdata, Igor) {\n  var _entity$processors$so, _entity$processors$dr;\n\n  if (entity.connections.sources.length > 0 && ((_entity$processors$so = entity.processors.source) == null ? void 0 : _entity$processors$so.xferQty) > 0) {\n    if (entity.processors.source.xferTimer >= entity.processors.source.xferTicks) {\n      var busXfer = Igor.processTEMP(Igor.getId(entity.connections.sources[entity.processors.source.xferTarget], \"buffers.out\"), \"buffer.busXfer\", {\n        xferCount: entity.processors.source.xferQty,\n        toBus: entity.processors.central\n      });\n\n      if (busXfer.full) {\n        entity.clogged = true;\n      }\n\n      ++entity.processors.source.xferTarget == entity.connections.sources.length && (entity.processors.source.xferTarget = 0);\n      entity.processors.source.xferTimer = 0;\n    } else {\n      entity.processors.source.xferTimer++;\n    }\n  }\n\n  if (entity.connections.drains.length > 0 && ((_entity$processors$dr = entity.processors.drain) == null ? void 0 : _entity$processors$dr.xferQty) > 0) {\n    if (entity.processors.drain.xferTimer >= entity.processors.drain.xferTicks) {\n      var _busXfer = Igor.processTEMP(Igor.getId(entity.connections.drains[entity.processors.drain.xferTarget], \"buffers.in\"), \"buffer.busXfer\", {\n        xferCount: entity.processors.drain.xferQty,\n        fromBus: entity.processors.central\n      });\n\n      if (_busXfer.full) {//skip outputting?\n      }\n\n      ++entity.processors.drain.xferTarget == entity.connections.drains.length && (entity.processors.drain.xferTarget = 0);\n      entity.processors.drain.xferTimer = 0;\n    } else {\n      entity.processors.drain.xferTimer++;\n    }\n  }\n};\n\nIgorJs_main__WEBPACK_IMPORTED_MODULE_0__[\"IgorUtils\"].defineObj(\"FactoryBus\", FactoryBus.New, FactoryBus);\n/*\r\n *  Resource Block\r\n */\n\nvar ResourceBlock = {};\n\nResourceBlock.New = function (params, newObj, Igor) {\n  newObj.name = params.name.string;\n  newObj.patchProperties = {};\n  newObj.spaceUsed = 50;\n  newObj.complexity = 1;\n  newObj.connections = {\n    drains: [],\n    maxDrains: 1\n  };\n  newObj.prepped = 0;\n  newObj.built = 0;\n  newObj.mining_ticks = NaN;\n  newObj.mining_drill = \"burner-mining-drill\";\n  newObj.buffers = {};\n  newObj.buffers.out = Igor.newComponent(\"entity.buffer\", {\n    restrictable: true,\n    stacks: 1,\n    stackSize: 0\n  }, newObj);\n  return [newObj];\n};\n\nResourceBlock.New._signal = \"facBlockUpdate\";\n\nResourceBlock.SetResource = function (obj, Igor) {\n  var resBlock = obj.at.ResourceBlock;\n\n  if (obj.at.ResourceBlock.patchProperties.resource) {\n    var buffer = Igor.getId(resBlock.buffers.out);\n    Igor.processTEMP(Igor.getNamedObject(\"player.inventory\"), \"inventory.add\", {\n      itemStacks: buffer.items\n    });\n    buffer.items = [];\n  }\n\n  obj.at.ResourceBlock.$_tags.push(\"tick\", \"processing\");\n  obj.at.ResourceBlock.patchProperties.resource = obj.which.resource;\n\n  if (obj.at.ResourceBlock.mining_drill) {\n    obj.at.ResourceBlock.patchProperties.mining_time = Igor.data.resource[obj.which.resource].mining_time / Igor.data.entity[obj.at.ResourceBlock.mining_drill].mining_speed * Igor.getStatic(\"config.TICKS_PER_SECOND\");\n    obj.at.ResourceBlock.mining_ticks = obj.at.ResourceBlock.patchProperties.mining_time;\n    obj.at.ResourceBlock.subIcon = obj.at.ResourceBlock.patchProperties.resource;\n  }\n};\n\nResourceBlock.SetResource.signature = {\n  at: \"ResourceBlock\",\n  which: 'resource'\n};\nResourceBlock.SetResource.CC_provide = \"resBlock.setResource\";\n\nResourceBlock.PrepSpace = function (obj, Igor) {\n  if (Igor.processTEMP(obj.player.inventory, \"inventory.consume\", {\n    itemStacks: Igor.getStatic('itemStackCost.resBlock_foundation')\n  })) {\n    obj.at.ResourceBlock.prepped++;\n    obj.at.ResourceBlock.spaceUsed += 10;\n    obj.at.ResourceBlock.complexity += 5;\n  } else {\n    console.error(\"unable to consume foundation costs\");\n  }\n};\n\nResourceBlock.PrepSpace.signature = {\n  at: \"ResourceBlock\",\n  player: \"inventory\"\n};\nResourceBlock.PrepSpace.CC_provide = \"resBlock.prepSpace\";\n\nResourceBlock.BuildMine = function (obj, Igor) {\n  if (obj.at.ResourceBlock.prepped == 0) return;\n\n  if (Igor.processTEMP(obj.player.inventory, \"inventory.consume\", {\n    itemStacks: Igor.getStatic('itemStackCost.resBlock_miner')\n  })) {\n    obj.at.ResourceBlock.prepped--;\n    obj.at.ResourceBlock.built++;\n    Igor.getId(obj.at.ResourceBlock.buffers.out).stackSize += 5;\n  }\n};\n\nResourceBlock.BuildMine.signature = {\n  at: \"ResourceBlock\",\n  player: \"inventory\"\n};\nResourceBlock.BuildMine.CC_provide = \"resBlock.buildMine\";\n\nResourceBlock.__foundationCost = function (obj, x_null, ret, Igor) {\n  var who = Igor.getId(obj);\n  var is = [{\n    name: \"stone\",\n    count: 5\n  }];\n  is.push({\n    name: \"transport-belt\",\n    count: Math.floor(who.spaceUsed / 10)\n  });\n  ret._result = {\n    tool: 'stackArray',\n    tip: 'Foundation Cost',\n    data: is\n  };\n};\n\nResourceBlock.__foundationCost.CC_utility = \"resBlock.__foundationCost\";\n\nResourceBlock.__minerCost = function (obj, args_null, ret, Igor) {\n  var who = Igor.getId(obj);\n  var is = [{\n    name: who.mining_drill,\n    count: 1\n  }];\n  ret._result = {\n    tool: 'stackArray',\n    tip: 'Foundation Cost',\n    data: is\n  };\n};\n\nResourceBlock.__minerCost.CC_utility = \"resBlock.__minerCost\";\n\nResourceBlock.tick = function (entity, tickdata, Igor) {\n  if (entity.built == 0 || !entity.patchProperties.mining_time) return;\n\n  if (entity.mining_ticks == 0) {\n    var stored = Igor.processTEMP(entity.buffers.out, \"inventory.add\", {\n      itemStacks: {\n        name: entity.patchProperties.resource,\n        count: entity.storedResources || entity.built\n      }\n    });\n    entity.mining_ticks = entity.patchProperties.mining_time;\n  } else {\n    entity.mining_ticks--;\n  }\n};\n\nIgorJs_main__WEBPACK_IMPORTED_MODULE_0__[\"IgorUtils\"].defineObj(\"ResourceBlock\", ResourceBlock.New, ResourceBlock);\nvar TechBlock = {};\n\nTechBlock.New = function (params, newObj, Igor) {\n  newObj.name = params.name.string;\n  newObj.spaceUsed = 50;\n  newObj.complexity = 10;\n  newObj.prepped = 0;\n  newObj.built = 0;\n  newObj.connections = {\n    sources: [],\n    maxSources: 1\n  };\n  newObj.buffers = {};\n  newObj.buffers.in = Igor.newComponent(\"entity.buffer\", {\n    restrictable: true,\n    stackSize: 10,\n    maxStack: 2\n  }, newObj.$_id);\n  newObj.techTreeClass = \"main\";\n  newObj.subIcon = \"automation-science-pack\";\n  newObj.research_speed = 1;\n  newObj.research_ticks = NaN;\n  newObj.research_time = 0;\n  newObj.buildingType = \"lab\";\n  newObj.foundationType = \"\";\n  return [newObj];\n};\n\nTechBlock.New._signal = \"facBlockUpdate\";\n\nTechBlock.prepSpace = function (obj, Igor) {\n  if (Igor.processTEMP(\"player.inventory\", \"inventory.consume\", {\n    itemStacks: Igor.processTEMP(obj.at.techBlock, \"techBlock.toolTips\", {\n      which: \"foundation\"\n    }).data\n  })) {\n    obj.at.techBlock.prepped++;\n    obj.at.techBlock.spaceUsed += 10;\n    obj.at.techBlock.complexity += 5;\n  } else {\n    Igor.view.warnToast(\"Not enough materials for foundation\");\n  }\n};\n\nTechBlock.prepSpace.signature = {\n  at: \"techBlock\"\n};\nTechBlock.prepSpace.CC_provide = \"techBlock.prepSpace\";\n\nTechBlock.BuildTech = function (obj, Igor) {\n  if (obj.at.techBlock.prepped == 0) return;\n\n  if (Igor.processTEMP(\"player.inventory\", \"inventory.consume\", {\n    itemStacks: Igor.processTEMP(obj.at.techBlock, \"techBlock.toolTips\", {\n      which: \"buildLab\"\n    }).data\n  })) {\n    obj.at.techBlock.prepped--;\n    obj.at.techBlock.built++;\n    Igor.getId(obj.at.techBlock.buffers.in).stackSize += 5;\n  } else {\n    Igor.view.warnToast(\"Not enough materials to build lab\");\n  }\n\n  if (!obj.at.techBlock.bufferSet) {\n    Igor.processTEMP(obj.at.techBlock.buffers.in, \"buffer.restrictList\", {\n      list: ['automation-science-pack', 'logistic-science-pack']\n    });\n    obj.at.techBlock.bufferSet = true;\n  }\n\n  obj.at.techBlock.$_tags.push(\"tick\", \"processing\");\n};\n\nTechBlock.BuildTech.signature = {\n  at: \"techBlock\"\n};\nTechBlock.BuildTech.CC_provide = \"techBlock.buildLab\";\n\nTechBlock.SetTree = function (obj, Igor) {\n  Igor.view.errorToast(\"Not Yet Implemented\");\n  /*\r\n      set building type\r\n          foundation type\r\n          researching_speed\r\n  */\n};\n\nTechBlock.SetTree.signature = {\n  at: 'techBlock'\n};\nTechBlock.SetTree.CC_provide = \"techBlock.setTree\";\n\nTechBlock.__tooltips = function (obj, args, ret, Igor) {\n  var who = Igor.getId(obj);\n  var data = [];\n  var tip = \"\";\n\n  switch (args.which) {\n    case 'foundation':\n      data.push({\n        name: \"inserter\",\n        count: 2\n      });\n      data.push({\n        name: \"stone\",\n        count: 5\n      });\n      break;\n\n    case 'buildLab':\n      data.push({\n        name: \"lab\",\n        count: 1\n      });\n      break;\n\n    case 3:\n      break;\n  }\n\n  ret._result = {\n    tool: \"stackArray\",\n    tip: tip,\n    data: data\n  };\n};\n\nTechBlock.__tooltips.Igor_operation = \"techBlock.toolTips\";\nTechBlock.__tooltips.CC_utility = \"techBlock.toolTips\";\n\nTechBlock.tick = function (obj, tickData, Igor) {\n  var research = Igor.getNamedObject('research').progressing;\n  if (!research) return;\n\n  if (Number.isNaN(obj.research_ticks) || obj.research_ticks === null) {\n    var cost = research.cost.ingredients.map(function (_ref) {\n      var name = _ref[0],\n          qty = _ref[1];\n      return {\n        name: name,\n        count: qty\n      };\n    });\n    var canConsume = Igor.processTEMP(obj.buffers.in, \"inventory.consume\", {\n      itemStacks: cost,\n      multi: obj.built\n    });\n    obj.research_time = research.cost.time * Igor.getStatic(\"config.TICKS_PER_SECOND\") * obj.research_speed;\n\n    if (!canConsume) {\n      obj.research_consumed = 0;\n      obj.research_ticks = obj.research_time * 0.1;\n      obj.stalled = true;\n      return;\n    }\n\n    obj.stalled = false;\n    obj.research_ticks = obj.research_time;\n    obj.research_consumed = canConsume;\n  } else if (obj.research_ticks) {\n    --obj.research_ticks;\n  } else if (obj.research_ticks <= 0) {\n    if (obj.research_consumed) {\n      var ret = Igor.processTEMP(research, \"research.update\", {\n        count: obj.research_consumed,\n        me: obj.$_id\n      });\n\n      var _cost = research.cost.ingredients.map(function (_ref2) {\n        var name = _ref2[0],\n            qty = _ref2[1];\n        return {\n          name: name,\n          count: qty\n        };\n      });\n\n      Igor.processTEMP(obj.buffers.in, \"inventory.add\", {\n        itemStacks: _cost,\n        force: true,\n        multi: ret\n      });\n    }\n\n    obj.research_ticks = NaN;\n  }\n};\n\nIgorJs_main__WEBPACK_IMPORTED_MODULE_0__[\"IgorUtils\"].defineObj(\"TechBlock\", TechBlock.New, TechBlock);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidjMvbC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9nYW1lQ29kZS9GYWN0b3J5QmxvY2tzLmpzP2JmN2YiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtJZ29yVXRpbHMgYXMgSWdvckpzfSBmcm9tIFwiSWdvckpzL21haW5cIlxyXG5pbXBvcnQge0NoYW1lbGVvblZpZXdlciBhcyBDaGFtZUpzfSBmcm9tIFwiQ2hhbWVsZW9uL21haW5cIlxyXG5pbXBvcnQgTSBmcm9tIFwibWluaW1hdGNoXCJcclxuXHJcbklnb3JKcy5zZXRTdGF0aWMoXCJpdGVtU3RhY2tDb3N0LmJ1c0V4cGFuc2lvblwiLCBbe25hbWU6IFwiaXJvbi1jaGVzdFwiLCBjb3VudDogMn1dKVxyXG5JZ29ySnMuc2V0U3RhdGljKFwiaXRlbVN0YWNrQ29zdC5idXNQcm9jZXNzaW5nXCIsIFt7bmFtZTogXCJpbnNlcnRlclwiLCBjb3VudDogMn1dKVxyXG5JZ29ySnMuc2V0U3RhdGljKFwiaXRlbVN0YWNrQ29zdC5yZXNCbG9ja19mb3VuZGF0aW9uXCIsIFt7bmFtZTogXCJzdG9uZVwiLCBjb3VudDogNX0sIHtuYW1lOiBcInRyYW5zcG9ydC1iZWx0XCIsIGNvdW50OiA0fV0pXHJcbklnb3JKcy5zZXRTdGF0aWMoXCJpdGVtU3RhY2tDb3N0LnJlc0Jsb2NrX21pbmVyXCIsIFt7bmFtZTogXCJidXJuZXItbWluaW5nLWRyaWxsXCIsIGNvdW50OiAxfV0pXHJcblxyXG5cclxuY29uc3QgRmFjdG9yeUJsb2NrID0ge31cclxuRmFjdG9yeUJsb2NrLk5ldyA9IChwYXJhbXMsIG5ld09iaiwgSWdvcikgPT4ge1xyXG4gICAgbGV0IGZlYXR1cmVzID0gSWdvci5nZXROYW1lZE9iamVjdChcImdsb2JhbFwiKS5hY3RpdmVGZWF0dXJlcy5mYWN0b3J5QmxvY2tzXHJcbiAgICBuZXdPYmoubmFtZSA9IHBhcmFtcy5uYW1lLnN0cmluZ1xyXG4gICAgbmV3T2JqLnNpemUgPSA1MFxyXG4gICAgbmV3T2JqLmNvbXBsZXhpdHkgPSAxMFxyXG4gICAgbmV3T2JqLmNvbm5lY3Rpb25zID0ge1xyXG4gICAgICAgIHNvdXJjZXM6IFtdXHJcbiAgICAgICAgLGRyYWluczogW11cclxuICAgICAgICAsbWF4U291cmNlczogZmVhdHVyZXMuYmxvY2tzTWF4U291cmNlcyB8fCAxXHJcbiAgICAgICAgLG1heERyYWluczogZmVhdHVyZXMuYmxvY2tzTWF4RHJhaW5zIHx8IDFcclxuICAgIH1cclxuICAgIGxldCBidWZmZXJTZXR0aW5ncyA9IHtcclxuICAgICAgICByZXN0cmljdGFibGU6IHRydWUsXHJcbiAgICAgICAgc3RhY2tzOiAxLFxyXG4gICAgICAgIHN0YWNrU2l6ZTogMTAsXHJcbiAgICB9XHJcbiAgICBuZXdPYmouYnVmZmVycyA9IHt9XHJcbiAgICBuZXdPYmouYnVmZmVycy5pbiA9IElnb3IubmV3Q29tcG9uZW50KFwiZW50aXR5LmJ1ZmZlclwiLCBidWZmZXJTZXR0aW5ncywgbmV3T2JqKVxyXG4gICAgbmV3T2JqLmJ1ZmZlcnMuaW50ZXJuYWwgPSBJZ29yLm5ld0NvbXBvbmVudChcImVudGl0eS5idWZmZXJcIiwgYnVmZmVyU2V0dGluZ3MsIG5ld09iailcclxuICAgIG5ld09iai5idWZmZXJzLm91dCA9IElnb3IubmV3Q29tcG9uZW50KFwiZW50aXR5LmJ1ZmZlclwiLCBidWZmZXJTZXR0aW5ncywgbmV3T2JqKVxyXG4gICAgbmV3T2JqLnByb2Nlc3NpbmdMaXN0ID0ge31cclxuXHJcbiAgICBuZXdPYmouc3ViSWNvbiA9IFwic3RvbmVcIlxyXG4gICAgbmV3T2JqLmZhY3RvcnlMaW5lcyA9IFtdXHJcbiAgICBuZXdPYmouZmFjdG9yeUxpbmVzLnB1c2goXHJcbiAgICAgICAgSWdvci5uZXdDb21wb25lbnQoXCJGYWN0b3J5TGluZVwiLCB7XHJcbiAgICAgICAgICAgIHNvdXJjZTogbmV3T2JqLmJ1ZmZlcnMuaW5cclxuICAgICAgICAgICAgLGRyYWluOiBuZXdPYmouYnVmZmVycy5vdXRcclxuICAgICAgICAgICAgLGludGVybmFsOiBuZXdPYmouYnVmZmVycy5pbnRlcm5hbFxyXG4gICAgICAgICAgICAscGFyZW50OiBuZXdPYmouJF9pZFxyXG4gICAgICAgICAgICAsb3JkZXI6IG5ld09iai5mYWN0b3J5TGluZXMubGVuZ3RoXHJcbiAgICAgICAgfSlcclxuICAgIClcclxuICAgIG5ld09iai4kX3RhZ3MucHVzaChcInRpY2tcIiwgXCJwcm9jZXNzaW5nXCIpXHJcbiAgICByZXR1cm4gW25ld09ial1cclxufVxyXG5GYWN0b3J5QmxvY2suTmV3LnNpZ25hdHVyZSA9IHsgfVxyXG5GYWN0b3J5QmxvY2suTmV3Ll9zaWduYWwgPSBcImZhY0Jsb2NrVXBkYXRlXCJcclxuRmFjdG9yeUJsb2NrLk5ld0NDQyA9IChwYXJhbXMsIElnb3IpID0+IHtcclxuICAgIElnb3IuYWRkTmV3T2JqZWN0KElnb3IuZ2V0TmFtZWRPYmplY3QoXCJnbG9iYWxcIikuZmFjQmxvY2tzLmJsb2NrcywgXCJGYWN0b3J5QmxvY2tcIiwgcGFyYW1zKVxyXG59XHJcbkZhY3RvcnlCbG9jay5OZXdDQ0Muc2lnbmF0dXJlID0ge1xyXG4gICAgbmFtZTogXCJzdHJpbmdcIlxyXG59XHJcbkZhY3RvcnlCbG9jay5OZXdDQ0MuQ0NfcHJvdmlkZSA9IFwiZmFjQmxvY2submV3QmxvY2tcIlxyXG5GYWN0b3J5QmxvY2suTmV3QnVzQ0NDID0gKHBhcmFtcywgSWdvcikgPT4ge1xyXG4gICAgSWdvci5hZGROZXdPYmplY3QoSWdvci5nZXROYW1lZE9iamVjdChcImdsb2JhbFwiKS5mYWNCbG9ja3MuYnVzZXMsIFwiRmFjdG9yeUJ1c1wiLCBwYXJhbXMpXHJcbn1cclxuRmFjdG9yeUJsb2NrLk5ld0J1c0NDQy5zaWduYXR1cmUgPSB7XHJcbiAgICBuYW1lOiBcInN0cmluZ1wiXHJcbn1cclxuRmFjdG9yeUJsb2NrLk5ld0J1c0NDQy5DQ19wcm92aWRlID0gXCJmYWNCbG9jay5uZXdCdXNcIlxyXG5GYWN0b3J5QmxvY2suTmV3UmVzQmxvY2sgPSAocGFyYW1zLCBJZ29yKSA9PiB7XHJcbiAgICBpZihJZ29yLmFkZE5ld09iamVjdChJZ29yLmdldE5hbWVkT2JqZWN0KFwiZ2xvYmFsXCIpLmZhY0Jsb2Nrcy5yZXNCbG9ja3MsIFwiUmVzb3VyY2VCbG9ja1wiLCBwYXJhbXMpKSB7XHJcbiAgICAgICAgSWdvci5nZXROYW1lZE9iamVjdChcImdsb2JhbFwiKS5sYW5kLnJlc19wYXRjaGVzX3VzZWQrK1xyXG4gICAgfVxyXG59XHJcbkZhY3RvcnlCbG9jay5OZXdSZXNCbG9jay5zaWduYXR1cmUgPSB7XHJcbiAgICBuYW1lOiBcInN0cmluZ1wiLCAgLy9XSVAgc2hvdWxkIGJlY29tZSByZXNvdXJjZSB2ZWluXHJcbn1cclxuRmFjdG9yeUJsb2NrLk5ld1Jlc0Jsb2NrLkNDX3Byb3ZpZGUgPSBcImZhY0Jsb2NrLm5ld1Jlc0Jsb2NrXCJcclxuRmFjdG9yeUJsb2NrLk5ld1RlY2hCbG9jayA9IChwYXJhbXMsIElnb3IpID0+IHtcclxuICAgIElnb3IuYWRkTmV3T2JqZWN0KElnb3IuZ2V0TmFtZWRPYmplY3QoXCJnbG9iYWxcIikuZmFjQmxvY2tzLnRlY2hCbG9ja3MsIFwiVGVjaEJsb2NrXCIsIHBhcmFtcylcclxufVxyXG5GYWN0b3J5QmxvY2suTmV3VGVjaEJsb2NrLnNpZ25hdHVyZSA9IHtcclxuICAgIG5hbWU6IFwic3RyaW5nXCJcclxufVxyXG5GYWN0b3J5QmxvY2suTmV3VGVjaEJsb2NrLkNDX3Byb3ZpZGUgPSBcImZhY0Jsb2NrLm5ld1RlY2hCbG9ja1wiXHJcbkZhY3RvcnlCbG9jay5fX3Rvb2x0aXBzID0gKG9iaiwgYXJncywgcmV0T2JqLCBJZ29yKSA9PiB7XHJcbiAgICBsZXQgd2hvID0gSWdvci5nZXRJZChvYmopIHx8IG51bGxcclxuICAgIGxldCBkYXRhID0gW11cclxuICAgIGxldCB0aXAgPSBcIlwiXHJcbiAgICBzd2l0Y2goYXJncy53aGljaCkge1xyXG4gICAgICAgIGNhc2UgXCJyZXNCbG9ja1wiOlxyXG4gICAgICAgICAgICBkYXRhLmxhbmRDb3N0ID0gXCJyZXNvdXJjZVwiXHJcbiAgICAgICAgICAgIGRhdGEuY29tcGxleGl0eSA9IDVcclxuICAgICAgICAgICAgdGlwID0gXCJOZXh0IFJlc291cmNlQmxvY2tcIlxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFwidGVjaEJsb2NrXCI6XHJcbiAgICAgICAgICAgIGRhdGEubGFuZENvc3QgPSA1MFxyXG4gICAgICAgICAgICBkYXRhLmNvbXBsZXhpdHkgPSA1XHJcbiAgICAgICAgICAgIHRpcCA9IFwiTmV4dCBUZWNoIEJsb2NrXCJcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBcImJ1c0xpbmVcIjpcclxuICAgICAgICAgICAgZGF0YS5sYW5kQ29zdCA9IDI1XHJcbiAgICAgICAgICAgIGRhdGEuY29tcGxleGl0eSA9IDVcclxuICAgICAgICAgICAgdGlwID0gXCJOZXh0IEJ1cyBMaW5lXCJcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBcImZhY3RvcnlCbG9ja1wiOlxyXG4gICAgICAgICAgICBkYXRhLmxhbmRDb3N0ID0gNTBcclxuICAgICAgICAgICAgZGF0YS5jb21wbGV4aXR5ID0gMTBcclxuICAgICAgICAgICAgdGlwID0gXCJOZXh0IEZhY3RvcnkgQmxvY2tcIlxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFwiYWRkTGluZVwiOlxyXG4gICAgICAgICAgICB0aXAgPSBcIk5ldyBGYWN0b3J5IExpbmVcIlxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgIH1cclxuICAgIHJldE9iai5fcmVzdWx0ID0ge3Rvb2w6IFwiYmxvY2tDb3N0c1wiLCB0aXAsIGRhdGF9XHJcbn1cclxuRmFjdG9yeUJsb2NrLl9fdG9vbHRpcHMuQ0NfdXRpbGl0eSA9IFwiZmFjQmxvY2suX190b29sdGlwc1wiXHJcbkZhY3RvcnlCbG9jay50aWNrID0gKG9iaiwgdGlja0RhdGEsIElnb3IpID0+IHtcclxuICAgIC8vIFByb2Nlc3MgSS9PIGJ1ZmZlcnNcclxuICAgIGlmKG9iai5jb25uZWN0aW9ucy5kcmFpbnMpIHtcclxuICAgICAgICAvL2NvbnNvbGUubG9nKCdwcm9jZXNzIGRyYWluczogcHVzaCBtb2RlJylcclxuICAgIH0gICAgXHJcbn1cclxuRmFjdG9yeUJsb2NrLnRpY2suc2lnbmF0dXJlID0geyB9XHJcbkZhY3RvcnlCbG9jay5TZWxlY3RTdWJJY29uID0gKG9iaiwgcGFyYW1zLCBJZ29yKSA9PiB7XHJcbiAgICBvYmouYXQuZmFjdG9yeUJsb2NrLnN1Ykljb24gPSBvYmoud2hpY2guaWNvblxyXG59XHJcbkZhY3RvcnlCbG9jay5TZWxlY3RTdWJJY29uLnNpZ25hdHVyZSA9IHtcclxuICAgIGF0OiBcImZhY3RvcnlCbG9ja1wiLFxyXG4gICAgd2hpY2g6IFwiaWNvblwiXHJcbn1cclxuRmFjdG9yeUJsb2NrLlNlbGVjdFN1Ykljb24uQ0NfcHJvdmlkZSA9IFwiZmFjdG9yeUJsb2NrLnNlbGVjdFN1Ykljb25cIlxyXG5GYWN0b3J5QmxvY2suQ29uc3VtZVN0YWNrcyA9ICh0YXJnZXQsIGFyZ3MsIHJldHVybk9iaiwgSWdvcikgPT4ge1xyXG4gICAgLy9XSVBcclxuICAgIGxldCBjb25zdW1hYmxlID0gYXJncy5pdGVtU3RhY2tzLnJlZHVjZSggKGFjY3VtX211bHRpLCB4KSA9PiB7XHJcbiAgICAgICAgaWYoYWNjdW1fbXVsdGk9PS0xKSByZXR1cm4gLTFcclxuICAgICAgICBsZXQgYXZhaWwgPSBJZ29yLnByb2Nlc3NURU1QKElnb3IuZ2V0SWQodGFyZ2V0LnByb2Nlc3NpbmdMaXN0W3gubmFtZV0uYXQpLml0ZW1zLCBcImludmVudG9yeS50b3RhbFwiLCB7bmFtZTogeC5uYW1lfSlcclxuICAgICAgICByZXR1cm4gYXZhaWw8eC5hbW91bnQgPyAtMSA6IE1hdGgubWluKGFjY3VtX211bHRpLCBNYXRoLmZsb29yKGF2YWlsL3guYW1vdW50KSlcclxuICAgIH0sIGFyZ3MubXVsdGkpXHJcbiAgICBpZihjb25zdW1hYmxlPj0xKSB7XHJcbiAgICAgICAgYXJncy5pdGVtU3RhY2tzLmZvckVhY2goICh4KSA9PiB7XHJcbiAgICAgICAgICAgIElnb3IucHJvY2Vzc1RFTVAoSWdvci5nZXRJZCh0YXJnZXQucHJvY2Vzc2luZ0xpc3RbeC5uYW1lXS5hdCksIFwiaW52ZW50b3J5LmNvbnN1bWVcIiwge2l0ZW1TdGFja3M6IHgsIG11bHRpOiBjb25zdW1hYmxlfSlcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG4gICAgcmV0dXJuT2JqLl9yZXN1bHQgPSBjb25zdW1hYmxlXHJcbn1cclxuRmFjdG9yeUJsb2NrLkNvbnN1bWVTdGFja3Muc2lnbmF0dXJlID0ge31cclxuRmFjdG9yeUJsb2NrLkNvbnN1bWVTdGFja3MuSWdvcl9vcGVyYXRpb24gPSBcImZhY3RvcnlCbG9jay5jb25zdW1lU3RhY2tzXCJcclxuRmFjdG9yeUJsb2NrLlByb2R1Y2VTdGFja3MgPSAodGFyZ2V0LCBhcmdzLCByZXR1cm5PYmosIElnb3IpID0+IHtcclxuICAgIGxldCBkZXBvc2l0YWJsZSA9IGFyZ3MuaXRlbVN0YWNrcy5yZWR1Y2UoIChhY2N1bV9tdWx0aSwgeCkgPT4ge1xyXG4gICAgICAgIGlmKGFjY3VtX211bHRpPT0tMSkgcmV0dXJuIC0xIC8vU2hvcnRjaXJjdWl0XHJcbiAgICAgICAgbGV0IGJ1ZmZlciA9IElnb3IuZ2V0SWQodGFyZ2V0LnByb2Nlc3NpbmdMaXN0W3gubmFtZV0uYXQpXHJcbiAgICAgICAgbGV0IGF2YWlsID0gYnVmZmVyLnN0YWNrU2l6ZSAtIElnb3IucHJvY2Vzc1RFTVAoYnVmZmVyLml0ZW1zLCBcImludmVudG9yeS50b3RhbFwiLCB7bmFtZTogeC5uYW1lfSlcclxuICAgICAgICByZXR1cm4gYXZhaWw8eC5hbW91bnQgPyAtMSA6IE1hdGgubWluKGFjY3VtX211bHRpLCBNYXRoLmZsb29yKGF2YWlsL3guYW1vdW50KSlcclxuICAgIH0sIGFyZ3MubXVsdGkpXHJcbiAgICBpZihkZXBvc2l0YWJsZT49MSkge1xyXG4gICAgICAgIGFyZ3MuaXRlbVN0YWNrcy5mb3JFYWNoKCAoeCkgPT4ge1xyXG4gICAgICAgICAgICBJZ29yLnByb2Nlc3NURU1QKElnb3IuZ2V0SWQodGFyZ2V0LnByb2Nlc3NpbmdMaXN0W3gubmFtZV0uYXQpLCBcImludmVudG9yeS5hZGRcIiwge2l0ZW1TdGFja3M6IHgsIG11bHRpOiBkZXBvc2l0YWJsZX0pXHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuICAgIHJldHVybk9iai5fcmVzdWx0ID0gZGVwb3NpdGFibGVcclxufVxyXG5GYWN0b3J5QmxvY2suUHJvZHVjZVN0YWNrcy5zaWduYXR1cmUgPSB7XHJcblxyXG59XHJcbkZhY3RvcnlCbG9jay5Qcm9kdWNlU3RhY2tzLklnb3Jfb3BlcmF0aW9uID0gXCJmYWN0b3J5QmxvY2sucHJvZHVjZVN0YWNrc1wiXHJcbkZhY3RvcnlCbG9jay5TZXRDb25uZWN0aW9uID0gIChvYmosIElnb3IpID0+IHtcclxuICAgIGxldCBjYWxsRm4gPSBvYmouZGlyLnN0cmluZz09XCJzb3VyY2VcIiA/IFwiRHJhaW5cIiA6IFwiU291cmNlXCJcclxuICAgIGlmKG9iai5hdC5mYWN0b3J5QmxvY2suY29ubmVjdGlvbnNbb2JqLmRpci5zdHJpbmcrJ3MnXT09IG9iai50b193aGljaC5mYWN0b3J5QnVzKSB7XHJcbiAgICAgICAgSWdvci5wcm9jZXNzVEVNUChvYmoudG9fd2hpY2guZmFjdG9yeUJ1cywgXCJmYWN0b3J5QnVzLmNsZWFyXCIrY2FsbEZuLCB7d2hvOiBvYmouYXQuZmFjdG9yeUJsb2NrLiRfaWR9KVxyXG4gICAgICAgIHJldHVyblxyXG4gICAgfVxyXG4gICAgLy9DbGVhciBwcmlvciBjb25uZWN0aW9uXHJcbiAgICAvL0NhbiBleGVjdXRlIG9uIGZhY3RvcnlCdXMuLi5cclxuICAgIGlmKElnb3IucHJvY2Vzc1RFTVAob2JqLnRvX3doaWNoLmZhY3RvcnlCdXMsIFwiZmFjdG9yeUJ1cy5hZGRcIitjYWxsRm4sIHt3aG86IG9iai5hdC5mYWN0b3J5QmxvY2suJF9pZH0pICkge1xyXG4gICAgICAgIG9iai5hdC5mYWN0b3J5QmxvY2suY29ubmVjdGlvbnNbb2JqLmRpci5zdHJpbmcrJ3MnXSA9IG9iai50b193aGljaC5mYWN0b3J5QnVzXHJcbiAgICB9XHJcbiAgICBJZ29yLnByb2Nlc3NURU1QKG9iai50b193aGljaC5mYWN0b3J5QnVzLCBcImZhY3RvcnlCdXMuY29ubmVjdFRvXCIsIHt9KVxyXG59XHJcbkZhY3RvcnlCbG9jay5TZXRDb25uZWN0aW9uLnNpZ25hdHVyZSA9IHtcclxuICAgIGF0OiBcImZhY3RvcnlCbG9ja1wiLFxyXG4gICAgdG9fd2hpY2g6IFwiZmFjdG9yeUJ1c1wiLFxyXG4gICAgZGlyOiBcInN0cmluZ1wiXHJcbn1cclxuRmFjdG9yeUJsb2NrLlNldENvbm5lY3Rpb24uQ0NfcHJvdmlkZSA9IFwiZmFjdG9yeUJsb2NrLnNldENvbm5lY3Rpb25cIlxyXG5cclxuRmFjdG9yeUJsb2NrLkFkZEZhY3RvcnlMaW5lID0gKG9iaiwgSWdvcikgPT4ge1xyXG4gICAgLy8gb2JqLmF0LmZhY3RvcnlCbG9jay5jb21wbGV4aXR5XHJcbiAgICAvLyBJbnZlbnRvcnkuY29uc3VtZSBzb21lIGNvc3RcclxuICAgIG9iai5hdC5mYWN0b3J5QmxvY2suZmFjdG9yeUxpbmVzLnB1c2goXHJcbiAgICAgICAgSWdvci5uZXdDb21wb25lbnQoXCJGYWN0b3J5TGluZVwiLCB7XHJcbiAgICAgICAgICAgIHNvdXJjZTogb2JqLmF0LmZhY3RvcnlCbG9jay5idWZmZXJzLmluXHJcbiAgICAgICAgICAgICxkcmFpbjogb2JqLmF0LmZhY3RvcnlCbG9jay5idWZmZXJzLm91dFxyXG4gICAgICAgICAgICAsaW50ZXJuYWw6IG9iai5hdC5mYWN0b3J5QmxvY2suYnVmZmVycy5pbnRlcm5hbFxyXG4gICAgICAgICAgICAscGFyZW50OiBvYmouYXQuZmFjdG9yeUJsb2NrLiRfaWRcclxuICAgICAgICAgICAgLG9yZGVyOiBvYmouYXQuZmFjdG9yeUJsb2NrLmZhY3RvcnlMaW5lcy5sZW5ndGggfHwgMFxyXG4gICAgICAgIH0pXHJcbiAgICApXHJcbiAgICAvLyBvYmouYXQuZmFjdG9yeUJsb2NrLmNvbXBsZXhpdHkrK1xyXG4gICAgSWdvci52aWV3LnNpZ25hbGVyLnNpZ25hbChcImdlbmVyYWxVcGRhdGVcIilcclxufVxyXG5GYWN0b3J5QmxvY2suQWRkRmFjdG9yeUxpbmUuc2lnbmF0dXJlID0ge1xyXG4gICAgYXQ6IFwiZmFjdG9yeUJsb2NrXCJcclxufVxyXG5GYWN0b3J5QmxvY2suQWRkRmFjdG9yeUxpbmUuQ0NfcHJvdmlkZSA9IFwiZmFjdG9yeUJsb2NrLmFkZExpbmVcIlxyXG5GYWN0b3J5QmxvY2suU2V0UHJvY2Vzc0l0ZW1zID0gKHRhcmdldCwgYXJncywgcmV0dXJuT2JqLCBJZ29yKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZygnc2V0IHByb2Nlc3MnKVxyXG4gICAgYXJncy5saXN0cy5jb25zdW1lLmZvckVhY2goICh4KSA9PiB7XHJcbiAgICAgICAgaWYoIXRhcmdldC5wcm9jZXNzaW5nTGlzdFt4XSkge1xyXG4gICAgICAgICAgICB0YXJnZXQucHJvY2Vzc2luZ0xpc3RbeF0gPSB7YXQ6IHRhcmdldC5idWZmZXJzLmluLCBjb25zdW1lOiBbYXJncy5saXN0SWRdfVxyXG4gICAgICAgIH0gZWxzZSBpZih0YXJnZXQucHJvY2Vzc2luZ0xpc3RbeF0uYXQgPT0gdGFyZ2V0LmJ1ZmZlcnMuaW50ZXJuYWwpIHtcclxuICAgICAgICAgICAgdGFyZ2V0LnByb2Nlc3NpbmdMaXN0W3hdLmNvbnN1bWUucHVzaChhcmdzLmxpc3RJZClcclxuICAgICAgICB9IGVsc2UgaWYodGFyZ2V0LnByb2Nlc3NpbmdMaXN0W3hdLmF0ID09IHRhcmdldC5idWZmZXJzLm91dCkge1xyXG4gICAgICAgICAgICAvLyBNb3ZlIHRvIGludGVybmFsXHJcbiAgICAgICAgICAgIHRhcmdldC5wcm9jZXNzaW5nTGlzdFt4XS5hdCA9IHRhcmdldC5idWZmZXJzLmludGVybmFsXHJcbiAgICAgICAgICAgIHRhcmdldC5wcm9jZXNzaW5nTGlzdFt4XS5jb25zdW1lID0gW11cclxuICAgICAgICAgICAgdGFyZ2V0LnByb2Nlc3NpbmdMaXN0W3hdLmNvbnN1bWUucHVzaChhcmdzLmxpc3RJZClcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvL3ggaXMgZm91bmQgYW5kIGF0IGlucHV0IGFscmVhZHlcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG4gICAgYXJncy5saXN0cy5wcm9kdWNlLmZvckVhY2goICh4KSA9PiB7XHJcbiAgICAgICAgaWYoIXRhcmdldC5wcm9jZXNzaW5nTGlzdFt4XSkge1xyXG4gICAgICAgICAgICB0YXJnZXQucHJvY2Vzc2luZ0xpc3RbeF0gPSB7YXQ6IHRhcmdldC5idWZmZXJzLm91dCwgcHJvZHVjZTogW2FyZ3MubGlzdElkXX1cclxuICAgICAgICB9IGVsc2UgaWYodGFyZ2V0LnByb2Nlc3NpbmdMaXN0W3hdLmF0PT10YXJnZXQuYnVmZmVycy5pbnRlcm5hbCkge1xyXG4gICAgICAgICAgICB0YXJnZXQucHJvY2Vzc2luZ0xpc3RbeF0ucHJvZHVjZS5wdXNoKGFyZ3MubGlzdElkKVxyXG4gICAgICAgIH0gZWxzZSBpZih0YXJnZXQucHJvY2Vzc2luZ0xpc3RbeF0uYXQ9PXRhcmdldC5idWZmZXJzLmluKSB7XHJcbiAgICAgICAgICAgIC8vbW92ZSBpdFxyXG4gICAgICAgICAgICB0YXJnZXQucHJvY2Vzc2luZ0xpc3RbeF0uYXQgPSB0YXJnZXQuYnVmZmVycy5pbnRlcm5hbFxyXG4gICAgICAgICAgICB0YXJnZXQucHJvY2Vzc2luZ0xpc3RbeF0ucHJvZHVjZSA9IFtdXHJcbiAgICAgICAgICAgIHRhcmdldC5wcm9jZXNzaW5nTGlzdFt4XS5wcm9kdWNlLnB1c2goYXJncy5saXN0SWQpXHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxuICAgIC8vVE9ETyB0aGlzIGRvZXNuJ3QgcmVzcGVjdCBzdGFjayBsaW1pdHMgb24gdGhlIGJ1ZmZlcnNcclxuICAgIElnb3IucHJvY2Vzc1RFTVAodGFyZ2V0LmJ1ZmZlcnMuaW4sIFwiYnVmZmVyLnJlc3RyaWN0TGlzdFwiLCB7bGlzdDogT2JqZWN0LmtleXModGFyZ2V0LnByb2Nlc3NpbmdMaXN0KS5maWx0ZXIoKHgpPT4ge3JldHVybiB0YXJnZXQucHJvY2Vzc2luZ0xpc3RbeF0uYXQ9PXRhcmdldC5idWZmZXJzLmlufSl9KVxyXG4gICAgSWdvci5wcm9jZXNzVEVNUCh0YXJnZXQuYnVmZmVycy5pbnRlcm5hbCwgXCJidWZmZXIucmVzdHJpY3RMaXN0XCIsIHtsaXN0OiBPYmplY3Qua2V5cyh0YXJnZXQucHJvY2Vzc2luZ0xpc3QpLmZpbHRlcigoeCk9PiB7cmV0dXJuIHRhcmdldC5wcm9jZXNzaW5nTGlzdFt4XS5hdD09dGFyZ2V0LmJ1ZmZlcnMuaW50ZXJuYWx9KX0pXHJcbiAgICBJZ29yLnByb2Nlc3NURU1QKHRhcmdldC5idWZmZXJzLm91dCwgXCJidWZmZXIucmVzdHJpY3RMaXN0XCIsIHtsaXN0OiBPYmplY3Qua2V5cyh0YXJnZXQucHJvY2Vzc2luZ0xpc3QpLmZpbHRlcigoeCk9PiB7cmV0dXJuIHRhcmdldC5wcm9jZXNzaW5nTGlzdFt4XS5hdD09dGFyZ2V0LmJ1ZmZlcnMub3V0fSl9KVxyXG59XHJcbkZhY3RvcnlCbG9jay5TZXRQcm9jZXNzSXRlbXMuSWdvcl9vcGVyYXRpb24gPSBcImZhY3RvcnlCbG9jay5zZXRQcm9jZXNzSXRlbXNcIlxyXG5GYWN0b3J5QmxvY2suQ2xlYXJQcm9jZXNzSXRlbXMgPSAodGFyZ2V0LCBhcmdzLCByZXR1cm5PYmosIElnb3IpID0+IHtcclxuICAgIGFyZ3MubGlzdHMuY29uc3VtZS5mb3JFYWNoKCAoeCkgPT4ge1xyXG4gICAgICAgIGxldCB3aGljaCA9IHRhcmdldC5wcm9jZXNzaW5nTGlzdFt4XVxyXG4gICAgICAgIHdoaWNoLmNvbnN1bWUuc3BsaWNlKHdoaWNoLmNvbnN1bWUuaW5kZXhPZihhcmdzLmxpc3RJZCksMSlcclxuICAgICAgICBpZih3aGljaC5jb25zdW1lLmxlbmd0aD09MCkge1xyXG4gICAgICAgICAgICBpZih3aGljaC5hdD09dGFyZ2V0LmJ1ZmZlcnMuaW50ZXJuYWwgJiYgd2hpY2gucHJvZHVjZT8ubGVuZ3RoPjApIHtcclxuICAgICAgICAgICAgICAgIHdoaWNoLmF0ID0gdGFyZ2V0LmJ1ZmZlcnMub3V0XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgdGFyZ2V0LnByb2Nlc3NpbmdMaXN0W3hdXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KVxyXG4gICAgYXJncy5saXN0cy5wcm9kdWNlLmZvckVhY2goICh4KSA9PiB7XHJcbiAgICAgICAgbGV0IHdoaWNoID0gdGFyZ2V0LnByb2Nlc3NpbmdMaXN0W3hdXHJcbiAgICAgICAgd2hpY2gucHJvZHVjZS5zcGxpY2Uod2hpY2gucHJvZHVjZS5pbmRleE9mKGFyZ3MubGlzdElkKSwxKVxyXG4gICAgICAgIGlmKHdoaWNoLnByb2R1Y2UubGVuZ3RoPT0wKSB7XHJcbiAgICAgICAgICAgIGlmKHdoaWNoLmF0PT10YXJnZXQuYnVmZmVycy5pbnRlcm5hbCAmJiB3aGljaC5jb25zdW1lPy5sZW5ndGg+MCkge1xyXG4gICAgICAgICAgICAgICAgd2hpY2guYXQgPSB0YXJnZXQuYnVmZmVycy5pblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlIHRhcmdldC5wcm9jZXNzaW5nTGlzdFt4XVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxuICAgIElnb3IucHJvY2Vzc1RFTVAoSWdvci5nZXRJZCh0YXJnZXQuYnVmZmVycy5pbiksIFwiYnVmZmVyLnJlc3RyaWN0TGlzdFwiLCB7bGlzdDogT2JqZWN0LmtleXModGFyZ2V0LnByb2Nlc3NpbmdMaXN0KS5maWx0ZXIoKHgpPT4ge3JldHVybiB0YXJnZXQucHJvY2Vzc2luZ0xpc3RbeF0uYXQ9PVwiaW5cIn0pfSlcclxuICAgIElnb3IucHJvY2Vzc1RFTVAoSWdvci5nZXRJZCh0YXJnZXQuYnVmZmVycy5pbnRlcm5hbCksIFwiYnVmZmVyLnJlc3RyaWN0TGlzdFwiLCB7bGlzdDogT2JqZWN0LmtleXModGFyZ2V0LnByb2Nlc3NpbmdMaXN0KS5maWx0ZXIoKHgpPT4ge3JldHVybiB0YXJnZXQucHJvY2Vzc2luZ0xpc3RbeF0uYXQ9PVwiaW50ZXJuYWxcIn0pfSlcclxuICAgIElnb3IucHJvY2Vzc1RFTVAoSWdvci5nZXRJZCh0YXJnZXQuYnVmZmVycy5vdXQpLCBcImJ1ZmZlci5yZXN0cmljdExpc3RcIiwge2xpc3Q6IE9iamVjdC5rZXlzKHRhcmdldC5wcm9jZXNzaW5nTGlzdCkuZmlsdGVyKCh4KT0+IHtyZXR1cm4gdGFyZ2V0LnByb2Nlc3NpbmdMaXN0W3hdLmF0PT1cIm91dFwifSl9KVxyXG59XHJcbkZhY3RvcnlCbG9jay5DbGVhclByb2Nlc3NJdGVtcy5JZ29yX29wZXJhdGlvbiA9IFwiZmFjdG9yeUJsb2NrLmNsZWFyUHJvY2Vzc0l0ZW1zXCJcclxuSWdvckpzLmRlZmluZU9iaihcIkZhY3RvcnlCbG9ja1wiLCBGYWN0b3J5QmxvY2suTmV3LCBGYWN0b3J5QmxvY2spXHJcblxyXG4vKlxyXG4gICAgRmFjdG9yeSBMaW5lXHJcbiovXHJcbmNvbnN0IEZhY3RvcnlMaW5lID0ge31cclxuRmFjdG9yeUxpbmUuTmV3ID0gKHBhcmFtcywgbmV3T2JqLCBJZ29yKSA9PiB7XHJcbiAgICBuZXdPYmoucHJlcHBlZCA9IDBcclxuICAgIG5ld09iai5idWlsdCA9IDBcclxuICAgIG5ld09iai5idWlsZGluZ1R5cGUgPSBudWxsXHJcbiAgICBuZXdPYmoucmVjaXBlID0gbnVsbFxyXG4gICAgbmV3T2JqLml0ZW1UYXJnZXRzID0gbnVsbFxyXG4gICAgbmV3T2JqLnByb2Nlc3NpbmdfdGltZSA9IC0xXHJcbiAgICBuZXdPYmouY29ubmVjdGlvbnMgPSB7XHJcbiAgICAgICAgc291cmNlOiBwYXJhbXMuc291cmNlLFxyXG4gICAgICAgIGRyYWluOiBwYXJhbXMuZHJhaW4sXHJcbiAgICAgICAgaW50ZXJuYWw6IHBhcmFtcy5pbnRlcm5hbFxyXG4gICAgfVxyXG4gICAgbmV3T2JqLm9yZGVyID0gcGFyYW1zLm9yZGVyXHJcbiAgICBuZXdPYmouJF9wYXJlbnQgPSBwYXJhbXMucGFyZW50XHJcbiAgICByZXR1cm4gW25ld09ial1cclxufVxyXG5GYWN0b3J5TGluZS5OZXcuc2lnbmF0dXJlID0ge1xyXG4gICAgc291cmNlOiAnZW50aXR5LmJ1ZmZlcicsXHJcbiAgICBkcmFpbjogJ2VudGl0eS5idWZmZXInLFxyXG4gICAgaW50ZXJuYWw6ICdlbnRpdHkuYnVmZmVyJ1xyXG59XHJcbkZhY3RvcnlMaW5lLk5ldy5fc2lnbmFsID0gXCJmYWNCbG9ja1VwZGF0ZVwiXHJcbkZhY3RvcnlMaW5lLl9fZGVsZXRlID0gKG9iaiwgSWdvcikgPT4ge1xyXG4gICAgY29uc29sZS5sb2coJ2dvdCBpdCEnKVxyXG59XHJcbkZhY3RvcnlMaW5lLl9fZGVsZXRlLklnb3Jfb3BlcmF0aW9uID0gXCJGYWN0b3J5TGluZS5kZWxldGVcIlxyXG5GYWN0b3J5TGluZS5TZXRUeXBlID0gKG9iaiwgSWdvcikgPT4ge1xyXG4gICAgb2JqLmF0LmZhY3RvcnlMaW5lLmJ1aWxkaW5nVHlwZSA9IG9iai53aGljaC5idWlsZGluZy5uYW1lXHJcbiAgICBvYmouYXQuZmFjdG9yeUxpbmUuY3JhZnRpbmdfY2F0ZWdvcmllcyA9IG9iai53aGljaC5idWlsZGluZy5jcmFmdGluZ19jYXRlZ29yaWVzXHJcbiAgICAvL0NyZWF0ZSBMb29rdXAgYnkgYnVpbGRpbmcgdHlwZVxyXG4gICAgb2JqLmF0LmZhY3RvcnlMaW5lLmZvdW5kYXRpb25Db3N0ID0gW1xyXG4gICAgICAgIHtuYW1lOiBcInN0b25lXCIsIGNvdW50OiA1fVxyXG4gICAgXVxyXG59XHJcbkZhY3RvcnlMaW5lLlNldFR5cGUuc2lnbmF0dXJlID0ge1xyXG4gICAgYXQ6IFtcImZhY3RvcnlMaW5lXCIsIFwiZmFjdG9yeUJsb2NrXCJdLFxyXG4gICAgd2hpY2g6IFwiYnVpbGRpbmdcIlxyXG59XHJcbkZhY3RvcnlMaW5lLlNldFR5cGUuQ0NfcHJvdmlkZSA9IFwiZmFjdG9yeUxpbmUuc2V0QnVpbGRpbmdcIlxyXG5GYWN0b3J5TGluZS5QcmVwID0gKG9iaiwgSWdvcikgPT4ge1xyXG4gICAgaWYoIW9iai5hdC5mYWN0b3J5TGluZS5mb3VuZGF0aW9uQ29zdCkgcmV0dXJuXHJcbiAgICBpZihJZ29yLnByb2Nlc3NURU1QKG9iai5wbGF5ZXIuaW52ZW50b3J5LCBcImludmVudG9yeS5jb25zdW1lXCIsIHtpdGVtU3RhY2tzOiBvYmouYXQuZmFjdG9yeUxpbmUuZm91bmRhdGlvbkNvc3R9KSkge1xyXG4gICAgICAgIG9iai5hdC5mYWN0b3J5TGluZS5wcmVwcGVkKytcclxuICAgICAgICBvYmouYXQuZmFjdG9yeUJsb2NrLnNpemUgKz0xMCAgLy8jIG1hZ2ljIG51bWJlclxyXG4gICAgICAgIG9iai5hdC5mYWN0b3J5QmxvY2suY29tcGxleGl0eSArPSA1ICAvLyMgbWFnaWMgbnVtYmVyXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDYW5ub3QgY29uc3VtZSBmb3VuZGF0aW9uIGNvc3RzXCIpXHJcbiAgICB9XHJcbn1cclxuRmFjdG9yeUxpbmUuUHJlcC5zaWduYXR1cmUgPSB7XHJcbiAgICBhdDogW1wiZmFjdG9yeUxpbmVcIiwgXCJmYWN0b3J5QmxvY2tcIl0sXHJcbiAgICBwbGF5ZXI6IFwiaW52ZW50b3J5XCJcclxufVxyXG5GYWN0b3J5TGluZS5QcmVwLkNDX3Byb3ZpZGUgPSBcImZhY3RvcnlMaW5lLnByZXBcIlxyXG5GYWN0b3J5TGluZS5FeHBhbmQgPSAob2JqLCBJZ29yKSA9PiB7XHJcbiAgICBpZihvYmouYXQuZmFjdG9yeUxpbmUucHJlcHBlZD09MCkgcmV0dXJuXHJcbiAgICBpZihJZ29yLnByb2Nlc3NURU1QKG9iai5wbGF5ZXIuaW52ZW50b3J5LCBcImludmVudG9yeS5jb25zdW1lXCIsIHtpdGVtU3RhY2tzOiB7bmFtZTogb2JqLmF0LmZhY3RvcnlMaW5lLmJ1aWxkaW5nVHlwZSwgY291bnQ6IDF9fSkpIHtcclxuICAgICAgICBpZihvYmouYXQuZmFjdG9yeUxpbmUucHJlcHBlZD4wIC8qICYmIGludmVudG9yeS5jb25zdW1lICovKSB7XHJcbiAgICAgICAgICAgIG9iai5hdC5mYWN0b3J5TGluZS5idWlsdCsrXHJcbiAgICAgICAgICAgIG9iai5hdC5mYWN0b3J5TGluZS5wcmVwcGVkLS1cclxuICAgICAgICAgICAgaWYob2JqLmF0LmZhY3RvcnlMaW5lLnJlY2lwZSkge1xyXG4gICAgICAgICAgICAgICAgaWYoTnVtYmVyLmlzSW50ZWdlcihvYmouYXQuZmFjdG9yeUxpbmUucHJvY2Vzc2luZ190aWNrcykpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL0lmIHdlJ3JlIGFscmVhZHkgYWN0aXZlbHkgcHJvY2Vzc2luZyBzb21ldGhpbmcuLi5cclxuICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdjdXJyZW50bHkgcHJvY2Vzc2luZyAnK29iai5hdC5mYWN0b3J5TGluZS5wcm9jZXNzaW5nX2NvdW50KVxyXG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ3RpY2tzOiAnK29iai5hdC5mYWN0b3J5TGluZS5wcm9jZXNzaW5nX3RpY2tzKVxyXG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ3RpbWVyOiAnK29iai5hdC5mYWN0b3J5TGluZS5wcm9jZXNzaW5nX3RpbWUpXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGNvbnN1bWVkID0gSWdvci5wcm9jZXNzVEVNUChvYmouYXQuZmFjdG9yeUJsb2NrLCBcImZhY3RvcnlCbG9jay5jb25zdW1lU3RhY2tzXCIsIHtpdGVtU3RhY2tzOiBvYmouYXQuZmFjdG9yeUxpbmUucmVjaXBlLmluZ3JlZGllbnRzLCBtdWx0aTogMX0pXHJcbiAgICAgICAgICAgICAgICAgICAgaWYoY29uc3VtZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmF0LmZhY3RvcnlMaW5lLnByb2Nlc3NpbmdfdGlja3MgKj0gKG9iai5hdC5mYWN0b3J5TGluZS5idWlsdC0xKS9vYmouYXQuZmFjdG9yeUxpbmUuYnVpbHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmF0LmZhY3RvcnlMaW5lLnByb2Nlc3NpbmdfY291bnQrK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCduZXcgdGlja3M6ICcrb2JqLmF0LmZhY3RvcnlMaW5lLnByb2Nlc3NpbmdfdGlja3MpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgb2JqLmF0LmZhY3RvcnlMaW5lLiRfdGFncy5wdXNoKFwidGlja1wiLCBcInByb2Nlc3NpbmdcIilcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkJ1aWxkaW5nIG5vdCBpbiBpbnZlbnRvcnlcIilcclxuICAgIH1cclxufVxyXG5GYWN0b3J5TGluZS5FeHBhbmQuc2lnbmF0dXJlID0ge1xyXG4gICAgYXQ6IFtcImZhY3RvcnlMaW5lXCIsIFwiZmFjdG9yeUJsb2NrXCJdLFxyXG4gICAgcGxheWVyOiAnaW52ZW50b3J5J1xyXG59XHJcbkZhY3RvcnlMaW5lLkV4cGFuZC5DQ19wcm92aWRlID0gXCJmYWN0b3J5TGluZS5hZGRCdWlsZGluZ1wiXHJcblxyXG4vKlxyXG4qL1xyXG5GYWN0b3J5TGluZS5TZXRSZWNpcGUgPSAob2JqLCBJZ29yKSA9PiB7XHJcbiAgICBpZihvYmouYXQuZmFjdG9yeUxpbmUucmVjaXBlKSB7XHJcbiAgICAgICAgaWYob2JqLmF0LmZhY3RvcnlMaW5lLnJlY2lwZSE9PW9iai53aGljaC5yZWNpcGUpIHtcclxuICAgICAgICBJZ29yLnByb2Nlc3NURU1QKFxyXG4gICAgICAgICAgICBvYmouYXQuZmFjdG9yeUJsb2NrXHJcbiAgICAgICAgICAgICxcImZhY3RvcnlCbG9jay5jbGVhclByb2Nlc3NJdGVtc1wiXHJcbiAgICAgICAgICAgICx7bGlzdHM6IG9iai5hdC5mYWN0b3J5TGluZS5wcm9jZXNzTGlzdH0pXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgb2JqLmF0LmZhY3RvcnlMaW5lLnJlY2lwZSA9IG51bGxcclxuICAgICAgICAgICAgb2JqLmF0LmZhY3RvcnlMaW5lLiRfdGFncy5kZWxldGUoXCJ0aWNrXCIpXHJcbiAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGxldCByZWNpcGUgPSBJZ29yLmRhdGEucmVjaXBlW29iai53aGljaC5yZWNpcGVdXHJcbiAgICBsZXQgbGlzdHMgPSB7Y29uc3VtZTogcmVjaXBlLmluZ3JlZGllbnRzLm1hcCggeCA9PiB4Lm5hbWUpLCBwcm9kdWNlOiByZWNpcGUucmVzdWx0cy5tYXAoIHggPT4geC5uYW1lKX1cclxuICAgIGxldCBGQl9zZXQgPSBJZ29yLnByb2Nlc3NURU1QKFxyXG4gICAgICAgICAgICAgICAgICAgIG9iai5hdC5mYWN0b3J5QmxvY2tcclxuICAgICAgICAgICAgICAgICAgICAsXCJmYWN0b3J5QmxvY2suc2V0UHJvY2Vzc0l0ZW1zXCIsXHJcbiAgICAgICAgICAgICAgICAgICAge2xpc3RzLCBsaXN0SWQ6IG9iai5hdC5mYWN0b3J5TGluZS4kX2lkfSlcclxuICAgIGlmKEZCX3NldCkge1xyXG4gICAgICAgIG9iai5hdC5mYWN0b3J5TGluZS5wcm9jZXNzTGlzdCA9IGxpc3RzXHJcbiAgICAgICAgb2JqLmF0LmZhY3RvcnlMaW5lLnJlY2lwZSA9IHJlY2lwZSAvLyBzdG9yZSBmdWxsIG9iamVjdCwgbm90IGFyZ3VtZW50IGZyb20gb2JqLndoaWNoLnJlY2lwZVxyXG4gICAgICAgIG9iai5hdC5mYWN0b3J5TGluZS5wcm9jZXNzaW5nX3RpbWUgPSByZWNpcGUuY3JhZnRpbmdfc3BlZWQgLyBJZ29yLmRhdGEuZW50aXR5W29iai5hdC5mYWN0b3J5TGluZS5idWlsZGluZ1R5cGVdLmNyYWZ0aW5nX3NwZWVkICogSWdvci5nZXRTdGF0aWMoXCJjb25maWcuVElDS1NfUEVSX1NFQ09ORFwiKVxyXG4gICAgICAgIG9iai5hdC5mYWN0b3J5TGluZS5wcm9jZXNzaW5nX3RpY2tzID0gTmFOXHJcbiAgICAgICAgb2JqLmF0LmZhY3RvcnlMaW5lLmJ1aWx0ICYmIG9iai5hdC5mYWN0b3J5TGluZS4kX3RhZ3MucHVzaChcInRpY2tcIiwgXCJwcm9jZXNzaW5nXCIpXHJcbiAgICAgICAgLy9KdXN0IHdhaXQgdGlsbCBuZXh0IHRpY2sgdG8gc3RhcnQgcHJvY2Vzc2luZyB0aGUgcmVjaXBlXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEZhY3RvcnkgQmxvY2sgc2V0IGZhaWxlZC4uLlxyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDb3VsZG4ndCBzZXQgbXkgaXRlbXMgb24gdGhlIHBhcmVudCBmYWN0b3J5QmxvY2tcIilcclxuICAgICAgICBkZWJ1Z2dlclxyXG4gICAgfVxyXG59XHJcbkZhY3RvcnlMaW5lLlNldFJlY2lwZS5zaWduYXR1cmUgPSB7XHJcbiAgICBhdDogW1wiZmFjdG9yeUxpbmVcIiwgXCJmYWN0b3J5QmxvY2tcIl0sXHJcbiAgICB3aGljaDogXCJyZWNpcGVcIixcclxuICAgIHBsYXllcjogXCJpbnZlbnRvcnlcIlxyXG59XHJcbkZhY3RvcnlMaW5lLlNldFJlY2lwZS5DQ19wcm92aWRlID0gXCJmYWN0b3J5TGluZS5zZXRSZWNpcGVcIlxyXG5GYWN0b3J5TGluZS5fX3Rvb2x0aXBzID0gKG9iaiwgYXJncywgcmV0LCBJZ29yKSA9PiB7XHJcbiAgICBsZXQgd2hvID0gSWdvci5nZXRJZChvYmopXHJcbiAgICBsZXQgZGF0YSA9IFtdXHJcbiAgICBsZXQgdGlwID0gXCJcIlxyXG4gICAgc3dpdGNoKGFyZ3Mud2hpY2gpIHtcclxuICAgICAgICBjYXNlIFwiZm91bmRhdGlvblwiOlxyXG4gICAgICAgICAgICBkYXRhLnB1c2goe25hbWU6IFwic3RvbmVcIiwgY291bnQ6IDV9KVxyXG4gICAgICAgICAgICB0aXAgPSBcIkZvdW5kYXRpb24gQ29zdFwiXHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gICAgcmV0Ll9yZXN1bHQgPSB7dG9vbDogXCJzdGFja0FycmF5XCIsIHRpcCwgZGF0YX1cclxufVxyXG5GYWN0b3J5TGluZS5fX3Rvb2x0aXBzLkNDX3V0aWxpdHkgPSBcImZhY3RvcnlMaW5lLnRvb2xUaXBzXCJcclxuRmFjdG9yeUxpbmUudGljayA9IChlbnRpdHksIHRpY2tkYXRhLCBJZ29yKSA9PiB7XHJcbiAgICBpZihlbnRpdHkuYnVpbHQ9PTAgfHwgIWVudGl0eS5wcm9jZXNzaW5nX3RpbWUgfHwgIWVudGl0eS5yZWNpcGUpIHJldHVybiAgLy9UT0RPIHR1cm4gdGhpcyBpbnRvIGFuIFwiYW50aS10aWNrXCIgdGFnXHJcbiAgICAvL2NvbnN1bWUgZnJvbSBidWZmZXJzIGlmIGVtcHR5XHJcbiAgICBpZihlbnRpdHkuZGVsYXkpIHtcclxuICAgICAgICBpZigtLWVudGl0eS5kZWxheT09MCkge1xyXG4gICAgICAgICAgICBlbnRpdHkuZGVsYXkgPSBudWxsXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVyblxyXG4gICAgfVxyXG4gICAgaWYoTnVtYmVyLmlzTmFOKGVudGl0eS5wcm9jZXNzaW5nX3RpY2tzKSkge1xyXG5cclxuICAgICAgICBsZXQgY29uc3VtZWQgPSBJZ29yLnByb2Nlc3NURU1QKGVudGl0eS4kX3BhcmVudCwgXCJmYWN0b3J5QmxvY2suY29uc3VtZVN0YWNrc1wiLCB7aXRlbVN0YWNrczogZW50aXR5LnJlY2lwZS5pbmdyZWRpZW50cywgbXVsdGk6IGVudGl0eS5idWlsdH0pXHJcbiAgICAgICAgaWYoY29uc3VtZWQ+IDApIHtcclxuICAgICAgICAgICAgZW50aXR5LnByb2Nlc3NpbmdfdGlja3MgPSAwXHJcbiAgICAgICAgICAgIGVudGl0eS5wcm9jZXNzaW5nX2NvdW50ID0gY29uc3VtZWRcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBlbnRpdHkuZGVsYXkgPSBNYXRoLmNlaWwoZW50aXR5LnByb2Nlc3NpbmdfdGltZSAqIDAuMSlcclxuICAgICAgICB9XHJcbiAgICB9IGVsc2UgaWYoZW50aXR5LnByb2Nlc3NpbmdfdGlja3M+PWVudGl0eS5wcm9jZXNzaW5nX3RpbWUpIHtcclxuICAgICAgICBsZXQgYWRkZWQgPSBJZ29yLnByb2Nlc3NURU1QKGVudGl0eS4kX3BhcmVudCwgXCJmYWN0b3J5QmxvY2sucHJvZHVjZVN0YWNrc1wiLCB7aXRlbVN0YWNrczogZW50aXR5LnJlY2lwZS5yZXN1bHRzLCBtdWx0aTogZW50aXR5LnByb2Nlc3NpbmdfY291bnR9KVxyXG4gICAgICAgIGlmKGFkZGVkPjApIHtcclxuICAgICAgICAgICAgZW50aXR5LnByb2Nlc3NpbmdfdGlja3M9TmFOXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gQ291bGRuJ3QgZGVwb3NpdCBhbGwgc28uLi4gdHJ5IGFnYWluIGFmdGVyIGEgZGVsYXlcclxuICAgICAgICAgICAgZW50aXR5LmRlbGF5ID0gTWF0aC5jZWlsKGVudGl0eS5wcm9jZXNzaW5nX3RpbWUgKiAwLjEpXHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBlbnRpdHkucHJvY2Vzc2luZ190aWNrcysrXHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5JZ29ySnMuZGVmaW5lT2JqKFwiRmFjdG9yeUxpbmVcIiwgRmFjdG9yeUxpbmUuTmV3LCBGYWN0b3J5TGluZSlcclxuXHJcbi8qKlxyXG4gKiAgKiBGYWN0b3J5IEJ1c1xyXG4gKiAgVE9ETzogc291cmNlL2RyYWlucyBhcmUgbWFuYWdlZCBmcm9tIGZhY3RvcnlCbG9ja3NcclxuICogIFRPRE86IFRpY2tlciB0byBtb3ZlIHRoaW5ncyBiZXR3ZWVuIGJ1ZmZlcnNcclxuICogIFRPRE86IFVwZ3JhZGVzIGFuZCBleHBhbnNpb25zXHJcbiAqIFxyXG4gKi9cclxuXHJcblxyXG5jb25zdCBGYWN0b3J5QnVzID0ge31cclxuRmFjdG9yeUJ1cy5OZXcgPSAocGFyYW1zLCBuZXdPYmosIElnb3IpID0+IHtcclxuICAgIG5ld09iai5uYW1lID0gcGFyYW1zLm5hbWUuc3RyaW5nXHJcbiAgICBuZXdPYmouc2l6ZSA9IDI1XHJcbiAgICBuZXdPYmouY29tcGxleGl0eSA9IDVcclxuICAgIG5ld09iai5jb25uZWN0aW9ucyA9IHtcclxuICAgICAgICBzb3VyY2VzOiBbXVxyXG4gICAgICAgICxkcmFpbnM6IFtdXHJcbiAgICAgICAgLG1heFNvdXJjZXM6IDBcclxuICAgICAgICAsbWF4RHJhaW5zOiAwXHJcbiAgICB9XHJcbiAgICBuZXdPYmoucHJvY2Vzc29ycyA9IHtcclxuICAgICAgICBzb3VyY2U6IHt4ZmVyVGlja3M6IDEyMCwgeGZlclRpbWVyOiAwLCB4ZmVyVGFyZ2V0OiAwLCB4ZmVyUXR5OiAwfVxyXG4gICAgICAgICxkcmFpbjoge3hmZXJUaWNrczogMTIwLCB4ZmVyVGltZXI6IDAsIHhmZXJUYXJnZXQ6IDAsIHhmZXJRdHk6IDB9XHJcbiAgICAgICAgLGNlbnRyYWw6IElnb3IubmV3Q29tcG9uZW50KFwiZW50aXR5LmJ1ZmZlclwiLCB7c3RhY2tzOiAxLCBzdGFja1NpemU6IDEwIH0sIG5ld09iai4kX2lkKVxyXG4gICAgfVxyXG4gICAgbmV3T2JqLmNsb2dnZWQgPSBmYWxzZVxyXG4gICAgbmV3T2JqLnN1Ykljb24gPSBcInN0b25lXCJcclxuICAgLy8gbmV3T2JqLiRfdGFncy5wdXNoKFwidGlja1wiLCBcInByb2Nlc3NpbmdcIilcclxuICAgIHJldHVybiBbbmV3T2JqXVxyXG59XHJcbkZhY3RvcnlCdXMuTmV3Ll9zaWduYWwgPSBcImZhY0Jsb2NrVXBkYXRlXCJcclxuRmFjdG9yeUJ1cy5TZWxlY3RTdWJJY29uID0gKG9iaiwgcGFyYW1zLCBJZ29yKSA9PiB7XHJcbiAgICBvYmouYXQuZmFjdG9yeUJ1cy5zdWJJY29uID0gb2JqLndoaWNoLmljb25cclxufVxyXG5GYWN0b3J5QnVzLlNlbGVjdFN1Ykljb24uc2lnbmF0dXJlID0ge1xyXG4gICAgYXQ6IFwiZmFjdG9yeUJ1c1wiLFxyXG4gICAgd2hpY2g6IFwiaWNvblwiXHJcbn1cclxuRmFjdG9yeUJ1cy5TZWxlY3RTdWJJY29uLkNDX3Byb3ZpZGUgPSBcImZhY3RvcnlCdXMuc2VsZWN0U3ViSWNvblwiXHJcbkZhY3RvcnlCdXMuQ2xlYXJDb25uZWN0aW9uID0gKHRhcmdldCwgYXJncywgcmV0dXJuT2JqLCBJZ29yKSA9PiB7XHJcbiAgICBsZXQgY29ubiA9IGFyZ3MuZGlyPT1cInNvdXJjZXNcIiA/IFwiZHJhaW5zXCI6IFwic291cmNlc1wiXHJcbiAgICBsZXQgaWR4ID0gdGFyZ2V0LmNvbm5lY3Rpb25zW2Nvbm5dLmZpbmRJbmRleCggKHgpID0+IHsgcmV0dXJuIHguYnVmZmVyPT1hcmdzLmlkIH0pXHJcbiAgICBpZihpZHg9PS0xKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJjb3VsZG4ndCBmaW5kIGluZGV4XCIpXHJcbiAgICAgICAgZGVidWdnZXJcclxuICAgIH1cclxuICAgIHRhcmdldC5jb25uZWN0aW9uc1tjb25uXS5zcGxpY2UoaWR4LCAxKVxyXG4gICAgdGFyZ2V0LnByb2Nlc3NvcnNbY29ubl0ueGZlclRhcmdldCA9IDA7XHJcbn1cclxuRmFjdG9yeUJ1cy5DbGVhckNvbm5lY3Rpb24uSWdvcl9vcGVyYXRpb24gPSBcImZhY3RvcnlCdXMuY2xlYXJDb25uZWN0aW9uXCJcclxuRmFjdG9yeUJ1cy5Db25uZWN0VG8gPSAob2JqLCBJZ29yKSA9PiB7XHJcbiAgICBsZXQgYnVzID0gSWdvci5nZXRJZChvYmouY29ubmVjdFRvLmZhY3RvcnlCdXMpXHJcbiAgICBsZXQgYmxvY2sgPSBJZ29yLmdldElkKG9iai5jb25uZWN0VG8uYmxvY2spXHJcbiAgICBpZihvYmouZGlyLnN0cmluZz09XCJvdXRwdXRcIikge1xyXG4gICAgICAgIC8vdGFyZ2V0IGRyYWluLCBidXMgc291cmNlXHJcbiAgICAgICAgaWYob2JqLmN1cnJlbnQuYnVzIT0tMSAmJiBibG9jay5jb25uZWN0aW9ucy5kcmFpbnMuaW5jbHVkZXMob2JqLmN1cnJlbnQuYnVzKSkge1xyXG4gICAgICAgICAgICBsZXQgaWR4ID0gYmxvY2suY29ubmVjdGlvbnMuZHJhaW5zLmluZGV4T2Yob2JqLmN1cnJlbnQuYnVzKVxyXG4gICAgICAgICAgICBibG9jay5jb25uZWN0aW9ucy5kcmFpbnMuc3BsaWNlKGlkeCwgMSlcclxuICAgICAgICAgICAgbGV0IGN1cnIgPSBJZ29yLmdldElkKG9iai5jdXJyZW50LmJ1cylcclxuICAgICAgICAgICAgaWR4ID0gY3Vyci5jb25uZWN0aW9ucy5zb3VyY2VzLmluZGV4T2YoYmxvY2suJF9pZClcclxuICAgICAgICAgICAgY3Vyci5jb25uZWN0aW9ucy5zb3VyY2VzLnNwbGljZShpZHgsIDEpXHJcbiAgICAgICAgICAgIGN1cnIucHJvY2Vzc29ycy5zb3VyY2UueGZlclRhcmdldCA9IDBcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoYmxvY2suY29ubmVjdGlvbnMuZHJhaW5zLmxlbmd0aDxibG9jay5jb25uZWN0aW9ucy5tYXhEcmFpbnMgJiZcclxuICAgICAgICAgICAgYnVzLmNvbm5lY3Rpb25zLnNvdXJjZXMubGVuZ3RoPGJ1cy5jb25uZWN0aW9ucy5tYXhTb3VyY2VzKSB7XHJcbiAgICAgICAgICAgIGJsb2NrLmNvbm5lY3Rpb25zLmRyYWlucy5wdXNoKG9iai5jb25uZWN0VG8uZmFjdG9yeUJ1cylcclxuICAgICAgICAgICAgYnVzLmNvbm5lY3Rpb25zLnNvdXJjZXMucHVzaChvYmouY29ubmVjdFRvLmJsb2NrKVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIElnb3Iudmlldy53YXJuVG9hc3QoXCJObyBhdmFpbGFibGUgc291cmNlIGNvbm5lY3Rpb25zXCIpXHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICAvL3RhcmdldCBzb3VyY2UsIGJ1cyBkcmFpblxyXG4gICAgICAgIGlmKG9iai5jdXJyZW50LmJ1cyE9LTEgJiYgYmxvY2suY29ubmVjdGlvbnMuc291cmNlcy5pbmNsdWRlcyhvYmouY3VycmVudC5idXMpKSB7XHJcbiAgICAgICAgICAgIGxldCBpZHggPSBibG9jay5jb25uZWN0aW9ucy5zb3VyY2VzLmluZGV4T2Yob2JqLmN1cnJlbnQuYnVzKVxyXG4gICAgICAgICAgICBibG9jay5jb25uZWN0aW9ucy5zb3VyY2VzLnNwbGljZShpZHgsIDEpXHJcbiAgICAgICAgICAgIGxldCBjdXJyID0gSWdvci5nZXRJZChvYmouY3VycmVudC5idXMpXHJcbiAgICAgICAgICAgIGlkeCA9IGN1cnIuY29ubmVjdGlvbnMuZHJhaW5zLmluZGV4T2YoYmxvY2suJF9pZClcclxuICAgICAgICAgICAgY3Vyci5jb25uZWN0aW9ucy5kcmFpbnMuc3BsaWNlKGlkeCwgMSlcclxuICAgICAgICAgICAgY3Vyci5wcm9jZXNzb3JzLmRyYWluLnhmZXJUYXJnZXQgPSAwXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGJsb2NrLmNvbm5lY3Rpb25zLnNvdXJjZXMubGVuZ3RoPGJsb2NrLmNvbm5lY3Rpb25zLm1heFNvdXJjZXMgJiZcclxuICAgICAgICAgICAgYnVzLmNvbm5lY3Rpb25zLmRyYWlucy5sZW5ndGg8YnVzLmNvbm5lY3Rpb25zLm1heERyYWlucykge1xyXG4gICAgICAgICAgICBibG9jay5jb25uZWN0aW9ucy5zb3VyY2VzLnB1c2gob2JqLmNvbm5lY3RUby5mYWN0b3J5QnVzKVxyXG4gICAgICAgICAgICBidXMuY29ubmVjdGlvbnMuZHJhaW5zLnB1c2gob2JqLmNvbm5lY3RUby5ibG9jaylcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBJZ29yLnZpZXcud2FyblRvYXN0KFwiTm8gYXZhaWxhYmxlIGRyYWluIGNvbm5lY3Rpb25zXCIpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgSWdvci52aWV3LnNpZ25hbGVyLnNpZ25hbChcImdlbmVyYWxVcGRhdGVcIilcclxufVxyXG5GYWN0b3J5QnVzLkNvbm5lY3RUby5zaWduYXR1cmUgPSB7XHJcbiAgICBkaXI6IFwic3RyaW5nXCIsXHJcbiAgICBjb25uZWN0VG86IFtcImZhY3RvcnlCdXNcIiwgXCJibG9ja1wiXSxcclxuICAgIGN1cnJlbnQ6IFwiYnVzXCJcclxufVxyXG5GYWN0b3J5QnVzLkNvbm5lY3RUby5DQ19wcm92aWRlID0gXCJmYWN0b3J5QnVzLmNvbm5lY3RUb1wiXHJcbkZhY3RvcnlCdXMuRXhwYW5kQnVzID0gKG9iaiwgSWdvcikgPT4ge1xyXG4gICAgbGV0IGNvbnN1bWVkID0gSWdvci5wcm9jZXNzVEVNUChvYmoucGxheWVyLmludmVudG9yeSwgXCJpbnZlbnRvcnkuY29uc3VtZVwiLCB7aXRlbVN0YWNrczogSWdvci5nZXRTdGF0aWMoXCJpdGVtU3RhY2tDb3N0LmJ1c0V4cGFuc2lvblwiKX0pXHJcbiAgICBpZighY29uc3VtZWQpIHJldHVyblxyXG4gICAgaWYob2JqLmRpci5zdHJpbmc9PVwic291cmNlXCIpIHtcclxuICAgICAgICBvYmouYXQuZmFjdG9yeUJ1cy5jb25uZWN0aW9ucy5tYXhTb3VyY2VzICs9IDFcclxuICAgICAgICBvYmouYXQuZmFjdG9yeUJ1cy5jb21wbGV4aXR5ICs9IDVcclxuICAgICAgICBvYmouYXQuZmFjdG9yeUJ1cy5zaXplICs9IDEwXHJcbiAgICB9IGVsc2UgaWYob2JqLmRpci5zdHJpbmc9PVwiZHJhaW5cIikge1xyXG4gICAgICAgIG9iai5hdC5mYWN0b3J5QnVzLmNvbm5lY3Rpb25zLm1heERyYWlucyArPSAxXHJcbiAgICAgICAgb2JqLmF0LmZhY3RvcnlCdXMuc2l6ZSArPSAxMFxyXG4gICAgICAgIG9iai5hdC5mYWN0b3J5QnVzLmNvbXBsZXhpdHkgKz0gNVxyXG4gICAgfVxyXG4gICAgaWYob2JqLmF0LmZhY3RvcnlCdXMuY29ubmVjdGlvbnMubWF4U291cmNlcyAmJiBvYmouYXQuZmFjdG9yeUJ1cy5jb25uZWN0aW9ucy5tYXhEcmFpbnMpIHtcclxuICAgICAgICBvYmouYXQuZmFjdG9yeUJ1cy4kX3RhZ3MucHVzaChcInRpY2tcIiwgXCJwcm9jZXNzaW5nXCIpXHJcbiAgICB9XHJcbiAgICBsZXQgY2VudHJhbCA9IElnb3IuZ2V0SWQob2JqLmF0LmZhY3RvcnlCdXMucHJvY2Vzc29ycy5jZW50cmFsKVxyXG4gICAgY2VudHJhbC5tYXhTdGFja3MgPSBNYXRoLm1pbihNYXRoLmNlaWwob2JqLmF0LmZhY3RvcnlCdXMuc2l6ZS81MCksIDE1KVxyXG59XHJcbkZhY3RvcnlCdXMuRXhwYW5kQnVzLnNpZ25hdHVyZSA9IHtcclxuICAgIGF0OiBcImZhY3RvcnlCdXNcIixcclxuICAgIGRpcjogXCJzdHJpbmdcIixcclxuICAgIHBsYXllcjogXCJpbnZlbnRvcnlcIlxyXG59IFxyXG5GYWN0b3J5QnVzLkV4cGFuZEJ1cy5DQ19wcm92aWRlID0gXCJmYWN0b3J5QnVzLmV4cGFuZEJ1c1wiXHJcbkZhY3RvcnlCdXMuRXhwYW5kUHJvY2Vzc2luZyA9IChvYmosIElnb3IpID0+IHtcclxuICAgIGxldCBjb25zdW1lZCA9IElnb3IucHJvY2Vzc1RFTVAob2JqLnBsYXllci5pbnZlbnRvcnksIFwiaW52ZW50b3J5LmNvbnN1bWVcIiwge2l0ZW1TdGFja3M6IElnb3IuZ2V0U3RhdGljKFwiaXRlbVN0YWNrQ29zdC5idXNQcm9jZXNzaW5nXCIpfSlcclxuICAgIGlmKCFjb25zdW1lZCkgcmV0dXJuXHJcbiAgICBpZihvYmouZGlyLnN0cmluZz09XCJzb3VyY2VcIikge1xyXG4gICAgICAgIG9iai5hdC5mYWN0b3J5QnVzLnByb2Nlc3NvcnMuc291cmNlLnhmZXJRdHkgKz0gMlxyXG4gICAgICAgIG9iai5hdC5mYWN0b3J5QnVzLnNpemUgKz0gMTBcclxuICAgICAgICBvYmouYXQuZmFjdG9yeUJ1cy5jb21wbGV4aXR5ICs9IDVcclxuICAgIH0gZWxzZSBpZihvYmouZGlyLnN0cmluZz09XCJkcmFpblwiKSB7XHJcbiAgICAgICAgb2JqLmF0LmZhY3RvcnlCdXMucHJvY2Vzc29ycy5kcmFpbi54ZmVyUXR5ICs9IDJcclxuICAgICAgICBvYmouYXQuZmFjdG9yeUJ1cy5zaXplICs9IDEwXHJcbiAgICAgICAgb2JqLmF0LmZhY3RvcnlCdXMuY29tcGxleGl0eSArPSA1XHJcbiAgICB9XHJcbn1cclxuRmFjdG9yeUJ1cy5FeHBhbmRQcm9jZXNzaW5nLnNpZ25hdHVyZSA9IHtcclxuICAgIGF0OiBcImZhY3RvcnlCdXNcIixcclxuICAgIGRpcjogXCJzdHJpbmdcIixcclxuICAgIHBsYXllcjogXCJpbnZlbnRvcnlcIlxyXG59XHJcbkZhY3RvcnlCdXMuRXhwYW5kUHJvY2Vzc2luZy5DQ19wcm92aWRlID0gXCJmYWN0b3J5QnVzLmV4cGFuZFByb2Nlc3NpbmdcIlxyXG5GYWN0b3J5QnVzLl9fdG9vbHRpcHMgPSAob2JqLCBhcmdzLCByZXQsIElnb3IpID0+IHtcclxuICAgIGlmKCFvYmopIHJldHVyblxyXG4gICAgbGV0IHdobyA9IElnb3IuZ2V0SWQob2JqKVxyXG4gICAgbGV0IGRhdGEgPSBbXVxyXG4gICAgbGV0IHRpcCA9IFwiXCJcclxuICAgIHN3aXRjaChhcmdzLndoaWNoKSB7XHJcbiAgICAgICAgY2FzZSBcImlucHV0X3Byb2Nlc3NpbmdcIjpcclxuICAgICAgICAgICAgZGF0YS5wdXNoKHtuYW1lOiBcImluc2VydGVyXCIsIGNvdW50OiAyfSlcclxuICAgICAgICAgICAgdGlwID0gXCJJbnB1dCBQcm9jZXNzaW5nXCJcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBcImV4cGFuZF9pbnB1dF9zb3VyY2VzXCI6XHJcbiAgICAgICAgICAgIGRhdGEucHVzaCh7bmFtZTogXCJpcm9uLWNoZXN0XCIsIGNvdW50OiAyfSlcclxuICAgICAgICAgICAgd2hvLmNvbm5lY3Rpb25zLm1heFNvdXJjZXMgJiYgZGF0YS5wdXNoKHtuYW1lOiBcInRyYW5zcG9ydC1iZWx0XCIsIGNvdW50OiA1Kndoby5jb25uZWN0aW9ucy5tYXhTb3VyY2VzfSlcclxuICAgICAgICAgICAgdGlwID0gXCJFeHBhbmQgU291cmNlIFBvaW50c1wiXHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgXCJvdXRwdXRfcHJvY2Vzc2luZ1wiOlxyXG4gICAgICAgICAgICBkYXRhLnB1c2goe25hbWU6IFwiaW5zZXJ0ZXJcIiwgY291bnQ6IDJ9KVxyXG4gICAgICAgICAgICB0aXAgPSBcIk91dHB1dCBQcm9jZXNzaW5nXCJcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBcImV4cGFuZF9vdXRwdXRfZHJhaW5zXCI6XHJcbiAgICAgICAgICAgIGRhdGEucHVzaCh7bmFtZTogXCJpcm9uLWNoZXN0XCIsIGNvdW50OiAyfSlcclxuICAgICAgICAgICAgd2hvLmNvbm5lY3Rpb25zLm1heERyYWlucyAmJiBkYXRhLnB1c2goe25hbWU6IFwidHJhbnNwb3J0LWJlbHRcIiwgY291bnQ6IDUqd2hvLmNvbm5lY3Rpb25zLm1heERyYWluc30pXHJcbiAgICAgICAgICAgIHRpcCA9IFwiRXhwYW5kIERyYWluIFBvaW50c1wiXHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIHJldC5fcmVzdWx0ID0ge3Rvb2w6IFwic3RhY2tBcnJheVwiLCB0aXAsIGRhdGF9XHJcbn1cclxuRmFjdG9yeUJ1cy5fX3Rvb2x0aXBzLkNDX3V0aWxpdHkgPSBcImJ1c0xpbmVfQ29zdHNcIlxyXG5GYWN0b3J5QnVzLkNsZWFyQ2xvZyA9IChvYmosIElnb3IpID0+IHtcclxuICAgIElnb3IuZ2V0SWQob2JqLmF0LmZhY3RvcnlCdXMucHJvY2Vzc29ycy5jZW50cmFsKS5pdGVtcy5mb3JFYWNoKCAoeCkgPT4ge1xyXG4gICAgICAgIElnb3IucHJvY2Vzc1RFTVAoXCJwbGF5ZXIuaW52ZW50b3J5XCIsIFwiaW52ZW50b3J5LmFkZFwiLCB7aXRlbVN0YWNrczogeH0pXHJcbiAgICAgICAgeC5jb3VudCA9IDA7XHJcbiAgICB9KVxyXG59XHJcbkZhY3RvcnlCdXMuQ2xlYXJDbG9nLnNpZ25hdHVyZSA9IHtcclxuICAgIGF0OiBcImZhY3RvcnlCdXNcIlxyXG59XHJcbkZhY3RvcnlCdXMuQ2xlYXJDbG9nLkNDX3Byb3ZpZGUgPSBcImZhY3RvcnlCdXMuY2xlYXJDbG9nXCJcclxuRmFjdG9yeUJ1cy50aWNrID0gKGVudGl0eSwgdGlja2RhdGEsIElnb3IpID0+IHtcclxuICAgIGlmKGVudGl0eS5jb25uZWN0aW9ucy5zb3VyY2VzLmxlbmd0aD4wICYmIGVudGl0eS5wcm9jZXNzb3JzLnNvdXJjZT8ueGZlclF0eT4wKSB7XHJcbiAgICAgICAgaWYoZW50aXR5LnByb2Nlc3NvcnMuc291cmNlLnhmZXJUaW1lcj49ZW50aXR5LnByb2Nlc3NvcnMuc291cmNlLnhmZXJUaWNrcykge1xyXG4gICAgICAgICAgICBsZXQgYnVzWGZlciA9IElnb3IucHJvY2Vzc1RFTVAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBJZ29yLmdldElkKGVudGl0eS5jb25uZWN0aW9ucy5zb3VyY2VzW2VudGl0eS5wcm9jZXNzb3JzLnNvdXJjZS54ZmVyVGFyZ2V0XSwgXCJidWZmZXJzLm91dFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLFwiYnVmZmVyLmJ1c1hmZXJcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLHt4ZmVyQ291bnQ6IGVudGl0eS5wcm9jZXNzb3JzLnNvdXJjZS54ZmVyUXR5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICx0b0J1czogZW50aXR5LnByb2Nlc3NvcnMuY2VudHJhbH0pXHJcbiAgICAgICAgICAgIGlmKGJ1c1hmZXIuZnVsbCkge1xyXG4gICAgICAgICAgICAgICAgZW50aXR5LmNsb2dnZWQgPSB0cnVlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKytlbnRpdHkucHJvY2Vzc29ycy5zb3VyY2UueGZlclRhcmdldD09ZW50aXR5LmNvbm5lY3Rpb25zLnNvdXJjZXMubGVuZ3RoICYmIChlbnRpdHkucHJvY2Vzc29ycy5zb3VyY2UueGZlclRhcmdldD0wKVxyXG4gICAgICAgICAgICBlbnRpdHkucHJvY2Vzc29ycy5zb3VyY2UueGZlclRpbWVyPTBcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBlbnRpdHkucHJvY2Vzc29ycy5zb3VyY2UueGZlclRpbWVyKytcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZihlbnRpdHkuY29ubmVjdGlvbnMuZHJhaW5zLmxlbmd0aD4wICAmJiBlbnRpdHkucHJvY2Vzc29ycy5kcmFpbj8ueGZlclF0eT4wKSB7XHJcbiAgICAgICAgaWYoZW50aXR5LnByb2Nlc3NvcnMuZHJhaW4ueGZlclRpbWVyPj1lbnRpdHkucHJvY2Vzc29ycy5kcmFpbi54ZmVyVGlja3MpIHtcclxuICAgICAgICAgICAgbGV0IGJ1c1hmZXIgPSBJZ29yLnByb2Nlc3NURU1QKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSWdvci5nZXRJZChlbnRpdHkuY29ubmVjdGlvbnMuZHJhaW5zW2VudGl0eS5wcm9jZXNzb3JzLmRyYWluLnhmZXJUYXJnZXRdLCBcImJ1ZmZlcnMuaW5cIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICxcImJ1ZmZlci5idXNYZmVyXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICx7eGZlckNvdW50OiBlbnRpdHkucHJvY2Vzc29ycy5kcmFpbi54ZmVyUXR5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsZnJvbUJ1czogZW50aXR5LnByb2Nlc3NvcnMuY2VudHJhbH0pXHJcbiAgICAgICAgICAgIGlmKGJ1c1hmZXIuZnVsbCkge1xyXG4gICAgICAgICAgICAgICAgLy9za2lwIG91dHB1dHRpbmc/XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKytlbnRpdHkucHJvY2Vzc29ycy5kcmFpbi54ZmVyVGFyZ2V0PT1lbnRpdHkuY29ubmVjdGlvbnMuZHJhaW5zLmxlbmd0aCAmJiAoZW50aXR5LnByb2Nlc3NvcnMuZHJhaW4ueGZlclRhcmdldD0wKVxyXG4gICAgICAgICAgICBlbnRpdHkucHJvY2Vzc29ycy5kcmFpbi54ZmVyVGltZXI9MFxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGVudGl0eS5wcm9jZXNzb3JzLmRyYWluLnhmZXJUaW1lcisrXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbn1cclxuXHJcbklnb3JKcy5kZWZpbmVPYmooXCJGYWN0b3J5QnVzXCIsIEZhY3RvcnlCdXMuTmV3LCBGYWN0b3J5QnVzKVxyXG5cclxuXHJcblxyXG4vKlxyXG4gKiAgUmVzb3VyY2UgQmxvY2tcclxuICovXHJcblxyXG5jb25zdCBSZXNvdXJjZUJsb2NrID0ge31cclxuUmVzb3VyY2VCbG9jay5OZXcgPSAocGFyYW1zLCBuZXdPYmosIElnb3IpID0+IHtcclxuICAgIG5ld09iai5uYW1lID0gcGFyYW1zLm5hbWUuc3RyaW5nXHJcbiAgICBuZXdPYmoucGF0Y2hQcm9wZXJ0aWVzID0ge31cclxuICAgIG5ld09iai5zcGFjZVVzZWQgPSA1MFxyXG4gICAgbmV3T2JqLmNvbXBsZXhpdHkgPSAxXHJcbiAgICBuZXdPYmouY29ubmVjdGlvbnMgPSB7XHJcbiAgICAgICAgZHJhaW5zOiBbXSxcclxuICAgICAgICBtYXhEcmFpbnM6IDFcclxuICAgIH1cclxuICAgIG5ld09iai5wcmVwcGVkID0gMFxyXG4gICAgbmV3T2JqLmJ1aWx0ID0gMFxyXG4gICAgbmV3T2JqLm1pbmluZ190aWNrcyA9IE5hTlxyXG4gICAgbmV3T2JqLm1pbmluZ19kcmlsbCA9IFwiYnVybmVyLW1pbmluZy1kcmlsbFwiXHJcbiAgICBuZXdPYmouYnVmZmVycyA9IHt9XHJcbiAgICBuZXdPYmouYnVmZmVycy5vdXQgPSBJZ29yLm5ld0NvbXBvbmVudChcImVudGl0eS5idWZmZXJcIiwge3Jlc3RyaWN0YWJsZTogdHJ1ZSwgc3RhY2tzOiAxLCBzdGFja1NpemU6IDB9LCBuZXdPYmopXHJcblxyXG4gICAgcmV0dXJuIFtuZXdPYmpdXHJcbn1cclxuUmVzb3VyY2VCbG9jay5OZXcuX3NpZ25hbCA9IFwiZmFjQmxvY2tVcGRhdGVcIlxyXG5SZXNvdXJjZUJsb2NrLlNldFJlc291cmNlID0gKG9iaiwgSWdvcikgPT4ge1xyXG4gICAgbGV0IHJlc0Jsb2NrID0gb2JqLmF0LlJlc291cmNlQmxvY2tcclxuICAgIGlmKG9iai5hdC5SZXNvdXJjZUJsb2NrLnBhdGNoUHJvcGVydGllcy5yZXNvdXJjZSkge1xyXG4gICAgICAgIGxldCBidWZmZXIgPSBJZ29yLmdldElkKHJlc0Jsb2NrLmJ1ZmZlcnMub3V0KVxyXG4gICAgICAgIElnb3IucHJvY2Vzc1RFTVAoSWdvci5nZXROYW1lZE9iamVjdChcInBsYXllci5pbnZlbnRvcnlcIiksIFwiaW52ZW50b3J5LmFkZFwiLCB7aXRlbVN0YWNrczogYnVmZmVyLml0ZW1zfSlcclxuICAgICAgICBidWZmZXIuaXRlbXMgPSBbXVxyXG4gICAgfVxyXG4gICAgb2JqLmF0LlJlc291cmNlQmxvY2suJF90YWdzLnB1c2goXCJ0aWNrXCIsIFwicHJvY2Vzc2luZ1wiKVxyXG4gICAgb2JqLmF0LlJlc291cmNlQmxvY2sucGF0Y2hQcm9wZXJ0aWVzLnJlc291cmNlID0gb2JqLndoaWNoLnJlc291cmNlXHJcbiAgICBpZihvYmouYXQuUmVzb3VyY2VCbG9jay5taW5pbmdfZHJpbGwpIHtcclxuICAgICAgICBvYmouYXQuUmVzb3VyY2VCbG9jay5wYXRjaFByb3BlcnRpZXMubWluaW5nX3RpbWUgPSBJZ29yLmRhdGEucmVzb3VyY2Vbb2JqLndoaWNoLnJlc291cmNlXS5taW5pbmdfdGltZSAvIElnb3IuZGF0YS5lbnRpdHlbb2JqLmF0LlJlc291cmNlQmxvY2subWluaW5nX2RyaWxsXS5taW5pbmdfc3BlZWQgKiBJZ29yLmdldFN0YXRpYyhcImNvbmZpZy5USUNLU19QRVJfU0VDT05EXCIpXHJcbiAgICAgICAgb2JqLmF0LlJlc291cmNlQmxvY2subWluaW5nX3RpY2tzID0gIG9iai5hdC5SZXNvdXJjZUJsb2NrLnBhdGNoUHJvcGVydGllcy5taW5pbmdfdGltZVxyXG4gICAgICAgIG9iai5hdC5SZXNvdXJjZUJsb2NrLnN1Ykljb24gPSBvYmouYXQuUmVzb3VyY2VCbG9jay5wYXRjaFByb3BlcnRpZXMucmVzb3VyY2VcclxuICAgIH1cclxufVxyXG5SZXNvdXJjZUJsb2NrLlNldFJlc291cmNlLnNpZ25hdHVyZSA9IHtcclxuICAgIGF0OiBcIlJlc291cmNlQmxvY2tcIixcclxuICAgIHdoaWNoOiAncmVzb3VyY2UnXHJcbn1cclxuUmVzb3VyY2VCbG9jay5TZXRSZXNvdXJjZS5DQ19wcm92aWRlID0gXCJyZXNCbG9jay5zZXRSZXNvdXJjZVwiXHJcblJlc291cmNlQmxvY2suUHJlcFNwYWNlID0gKG9iaiwgSWdvcikgPT4ge1xyXG4gICAgaWYoSWdvci5wcm9jZXNzVEVNUChvYmoucGxheWVyLmludmVudG9yeSwgXCJpbnZlbnRvcnkuY29uc3VtZVwiLCB7aXRlbVN0YWNrczogSWdvci5nZXRTdGF0aWMoJ2l0ZW1TdGFja0Nvc3QucmVzQmxvY2tfZm91bmRhdGlvbicpfSkpIHtcclxuICAgICAgICBvYmouYXQuUmVzb3VyY2VCbG9jay5wcmVwcGVkKytcclxuICAgICAgICBvYmouYXQuUmVzb3VyY2VCbG9jay5zcGFjZVVzZWQgKz0gMTBcclxuICAgICAgICBvYmouYXQuUmVzb3VyY2VCbG9jay5jb21wbGV4aXR5ICs9IDVcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcInVuYWJsZSB0byBjb25zdW1lIGZvdW5kYXRpb24gY29zdHNcIilcclxuICAgIH1cclxuXHJcbn1cclxuUmVzb3VyY2VCbG9jay5QcmVwU3BhY2Uuc2lnbmF0dXJlID0ge1xyXG4gICAgYXQ6IFwiUmVzb3VyY2VCbG9ja1wiLFxyXG4gICAgcGxheWVyOiBcImludmVudG9yeVwiXHJcbn1cclxuUmVzb3VyY2VCbG9jay5QcmVwU3BhY2UuQ0NfcHJvdmlkZSA9IFwicmVzQmxvY2sucHJlcFNwYWNlXCJcclxuUmVzb3VyY2VCbG9jay5CdWlsZE1pbmUgPSAob2JqLCBJZ29yKSA9PiB7XHJcbiAgICBpZihvYmouYXQuUmVzb3VyY2VCbG9jay5wcmVwcGVkPT0wKSByZXR1cm5cclxuICAgIGlmKElnb3IucHJvY2Vzc1RFTVAob2JqLnBsYXllci5pbnZlbnRvcnksIFwiaW52ZW50b3J5LmNvbnN1bWVcIiwge2l0ZW1TdGFja3M6IElnb3IuZ2V0U3RhdGljKCdpdGVtU3RhY2tDb3N0LnJlc0Jsb2NrX21pbmVyJyl9KSkge1xyXG4gICAgICAgIG9iai5hdC5SZXNvdXJjZUJsb2NrLnByZXBwZWQtLVxyXG4gICAgICAgIG9iai5hdC5SZXNvdXJjZUJsb2NrLmJ1aWx0KytcclxuICAgICAgICBJZ29yLmdldElkKG9iai5hdC5SZXNvdXJjZUJsb2NrLmJ1ZmZlcnMub3V0KS5zdGFja1NpemUgKz0gNVxyXG4gICAgfVxyXG59XHJcblJlc291cmNlQmxvY2suQnVpbGRNaW5lLnNpZ25hdHVyZSA9IHtcclxuICAgIGF0OiBcIlJlc291cmNlQmxvY2tcIixcclxuICAgIHBsYXllcjogXCJpbnZlbnRvcnlcIlxyXG59XHJcblJlc291cmNlQmxvY2suQnVpbGRNaW5lLkNDX3Byb3ZpZGUgPSBcInJlc0Jsb2NrLmJ1aWxkTWluZVwiXHJcblJlc291cmNlQmxvY2suX19mb3VuZGF0aW9uQ29zdCA9IChvYmosIHhfbnVsbCwgcmV0LCBJZ29yKSA9PiB7XHJcbiAgICBsZXQgd2hvID0gSWdvci5nZXRJZChvYmopXHJcbiAgICBsZXQgaXMgPSBbe25hbWU6IFwic3RvbmVcIiwgY291bnQ6IDV9XVxyXG4gICAgaXMucHVzaCh7bmFtZTogXCJ0cmFuc3BvcnQtYmVsdFwiLCBjb3VudDogTWF0aC5mbG9vcih3aG8uc3BhY2VVc2VkLzEwKX0pXHJcbiAgICByZXQuX3Jlc3VsdCA9IHt0b29sOiAnc3RhY2tBcnJheScsIHRpcDogJ0ZvdW5kYXRpb24gQ29zdCcsIGRhdGE6IGlzfVxyXG59XHJcblJlc291cmNlQmxvY2suX19mb3VuZGF0aW9uQ29zdC5DQ191dGlsaXR5ID0gXCJyZXNCbG9jay5fX2ZvdW5kYXRpb25Db3N0XCJcclxuUmVzb3VyY2VCbG9jay5fX21pbmVyQ29zdCA9IChvYmosIGFyZ3NfbnVsbCwgcmV0LCBJZ29yKSA9PiB7XHJcbiAgICBsZXQgd2hvID0gSWdvci5nZXRJZChvYmopXHJcbiAgICBsZXQgaXMgPSBbe25hbWU6IHdoby5taW5pbmdfZHJpbGwsIGNvdW50OiAxfV1cclxuICAgIHJldC5fcmVzdWx0ID0ge3Rvb2w6ICdzdGFja0FycmF5JywgdGlwOiAnRm91bmRhdGlvbiBDb3N0JywgZGF0YTogaXN9XHJcbn1cclxuUmVzb3VyY2VCbG9jay5fX21pbmVyQ29zdC5DQ191dGlsaXR5ID0gXCJyZXNCbG9jay5fX21pbmVyQ29zdFwiXHJcblJlc291cmNlQmxvY2sudGljayA9IChlbnRpdHksIHRpY2tkYXRhLCBJZ29yKSA9PiB7XHJcbiAgICBpZihlbnRpdHkuYnVpbHQ9PTAgfHwgIWVudGl0eS5wYXRjaFByb3BlcnRpZXMubWluaW5nX3RpbWUpIHJldHVyblxyXG4gICAgaWYoZW50aXR5Lm1pbmluZ190aWNrcz09MCkge1xyXG4gICAgICAgIGxldCBzdG9yZWQgPSBJZ29yLnByb2Nlc3NURU1QKGVudGl0eS5idWZmZXJzLm91dCwgXCJpbnZlbnRvcnkuYWRkXCIsIHtpdGVtU3RhY2tzOiB7bmFtZTogZW50aXR5LnBhdGNoUHJvcGVydGllcy5yZXNvdXJjZSwgY291bnQ6IGVudGl0eS5zdG9yZWRSZXNvdXJjZXMgfHwgZW50aXR5LmJ1aWx0fX0pXHJcbiAgICAgICAgZW50aXR5Lm1pbmluZ190aWNrcyA9IGVudGl0eS5wYXRjaFByb3BlcnRpZXMubWluaW5nX3RpbWVcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZW50aXR5Lm1pbmluZ190aWNrcy0tXHJcbiAgICB9XHJcbn1cclxuSWdvckpzLmRlZmluZU9iaihcIlJlc291cmNlQmxvY2tcIiwgUmVzb3VyY2VCbG9jay5OZXcsIFJlc291cmNlQmxvY2spXHJcblxyXG5jb25zdCBUZWNoQmxvY2sgPSB7fVxyXG5UZWNoQmxvY2suTmV3ID0gKHBhcmFtcywgbmV3T2JqLCBJZ29yKSA9PiB7XHJcbiAgICBuZXdPYmoubmFtZSA9IHBhcmFtcy5uYW1lLnN0cmluZ1xyXG4gICAgbmV3T2JqLnNwYWNlVXNlZCA9IDUwXHJcbiAgICBuZXdPYmouY29tcGxleGl0eSA9IDEwXHJcbiAgICBuZXdPYmoucHJlcHBlZCA9IDBcclxuICAgIG5ld09iai5idWlsdCA9IDBcclxuICAgIG5ld09iai5jb25uZWN0aW9ucyA9IHsgc291cmNlczogW10sIG1heFNvdXJjZXM6IDF9XHJcbiAgICBuZXdPYmouYnVmZmVycyA9IHt9XHJcbiAgICBuZXdPYmouYnVmZmVycy5pbiA9IElnb3IubmV3Q29tcG9uZW50KFwiZW50aXR5LmJ1ZmZlclwiLCB7cmVzdHJpY3RhYmxlOiB0cnVlLCBzdGFja1NpemU6IDEwLCBtYXhTdGFjazogMn0sIG5ld09iai4kX2lkKVxyXG4gICAgbmV3T2JqLnRlY2hUcmVlQ2xhc3MgPSBcIm1haW5cIlxyXG4gICAgbmV3T2JqLnN1Ykljb24gPSBcImF1dG9tYXRpb24tc2NpZW5jZS1wYWNrXCJcclxuICAgIG5ld09iai5yZXNlYXJjaF9zcGVlZCA9IDFcclxuICAgIG5ld09iai5yZXNlYXJjaF90aWNrcyA9IE5hTlxyXG4gICAgbmV3T2JqLnJlc2VhcmNoX3RpbWUgPSAwXHJcbiAgICBuZXdPYmouYnVpbGRpbmdUeXBlID0gXCJsYWJcIlxyXG4gICAgbmV3T2JqLmZvdW5kYXRpb25UeXBlID0gXCJcIlxyXG4gICAgcmV0dXJuIFtuZXdPYmpdXHJcbn1cclxuVGVjaEJsb2NrLk5ldy5fc2lnbmFsID0gXCJmYWNCbG9ja1VwZGF0ZVwiXHJcblRlY2hCbG9jay5wcmVwU3BhY2UgPSAob2JqLCBJZ29yKSA9PiB7XHJcbiAgICBpZihJZ29yLnByb2Nlc3NURU1QKFwicGxheWVyLmludmVudG9yeVwiLCBcImludmVudG9yeS5jb25zdW1lXCIsIHtpdGVtU3RhY2tzOiBJZ29yLnByb2Nlc3NURU1QKG9iai5hdC50ZWNoQmxvY2ssIFwidGVjaEJsb2NrLnRvb2xUaXBzXCIsIHt3aGljaDogXCJmb3VuZGF0aW9uXCJ9KS5kYXRhIH0pKSB7XHJcbiAgICAgICAgb2JqLmF0LnRlY2hCbG9jay5wcmVwcGVkKytcclxuICAgICAgICBvYmouYXQudGVjaEJsb2NrLnNwYWNlVXNlZCArPSAxMFxyXG4gICAgICAgIG9iai5hdC50ZWNoQmxvY2suY29tcGxleGl0eSArPSA1XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIElnb3Iudmlldy53YXJuVG9hc3QoXCJOb3QgZW5vdWdoIG1hdGVyaWFscyBmb3IgZm91bmRhdGlvblwiKVxyXG4gICAgfVxyXG59XHJcblRlY2hCbG9jay5wcmVwU3BhY2Uuc2lnbmF0dXJlID0ge1xyXG4gICAgYXQ6IFwidGVjaEJsb2NrXCJcclxufVxyXG5UZWNoQmxvY2sucHJlcFNwYWNlLkNDX3Byb3ZpZGUgPSBcInRlY2hCbG9jay5wcmVwU3BhY2VcIlxyXG5UZWNoQmxvY2suQnVpbGRUZWNoID0gKG9iaixJZ29yKSA9PiB7XHJcbiAgICBpZihvYmouYXQudGVjaEJsb2NrLnByZXBwZWQ9PTApIHJldHVyblxyXG4gICAgaWYoSWdvci5wcm9jZXNzVEVNUChcInBsYXllci5pbnZlbnRvcnlcIiwgXCJpbnZlbnRvcnkuY29uc3VtZVwiLCB7aXRlbVN0YWNrczogSWdvci5wcm9jZXNzVEVNUChvYmouYXQudGVjaEJsb2NrLCBcInRlY2hCbG9jay50b29sVGlwc1wiLCB7d2hpY2g6IFwiYnVpbGRMYWJcIn0pLmRhdGEgfSkpIHtcclxuICAgICAgICBvYmouYXQudGVjaEJsb2NrLnByZXBwZWQtLVxyXG4gICAgICAgIG9iai5hdC50ZWNoQmxvY2suYnVpbHQrK1xyXG4gICAgICAgIElnb3IuZ2V0SWQob2JqLmF0LnRlY2hCbG9jay5idWZmZXJzLmluKS5zdGFja1NpemUgKz0gNVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBJZ29yLnZpZXcud2FyblRvYXN0KFwiTm90IGVub3VnaCBtYXRlcmlhbHMgdG8gYnVpbGQgbGFiXCIpXHJcbiAgICB9XHJcbiAgICBpZighb2JqLmF0LnRlY2hCbG9jay5idWZmZXJTZXQpIHtcclxuICAgICAgICBJZ29yLnByb2Nlc3NURU1QKG9iai5hdC50ZWNoQmxvY2suYnVmZmVycy5pbiwgXCJidWZmZXIucmVzdHJpY3RMaXN0XCIsIHtsaXN0OiBbJ2F1dG9tYXRpb24tc2NpZW5jZS1wYWNrJywgJ2xvZ2lzdGljLXNjaWVuY2UtcGFjayddfSlcclxuICAgICAgICBvYmouYXQudGVjaEJsb2NrLmJ1ZmZlclNldCA9IHRydWVcclxuICAgIH1cclxuICAgIG9iai5hdC50ZWNoQmxvY2suJF90YWdzLnB1c2goXCJ0aWNrXCIsIFwicHJvY2Vzc2luZ1wiKVxyXG59XHJcblRlY2hCbG9jay5CdWlsZFRlY2guc2lnbmF0dXJlID0ge1xyXG4gICAgYXQ6IFwidGVjaEJsb2NrXCIsXHJcblxyXG59XHJcblRlY2hCbG9jay5CdWlsZFRlY2guQ0NfcHJvdmlkZT1cInRlY2hCbG9jay5idWlsZExhYlwiXHJcblRlY2hCbG9jay5TZXRUcmVlID0gKG9iaiwgSWdvcikgPT4ge1xyXG4gICAgSWdvci52aWV3LmVycm9yVG9hc3QoXCJOb3QgWWV0IEltcGxlbWVudGVkXCIpXHJcbiAgICAvKlxyXG4gICAgICAgIHNldCBidWlsZGluZyB0eXBlXHJcbiAgICAgICAgICAgIGZvdW5kYXRpb24gdHlwZVxyXG4gICAgICAgICAgICByZXNlYXJjaGluZ19zcGVlZFxyXG4gICAgKi9cclxufVxyXG5UZWNoQmxvY2suU2V0VHJlZS5zaWduYXR1cmUgPSB7XHJcbiAgICBhdDogJ3RlY2hCbG9jaydcclxufVxyXG5UZWNoQmxvY2suU2V0VHJlZS5DQ19wcm92aWRlPVwidGVjaEJsb2NrLnNldFRyZWVcIlxyXG5UZWNoQmxvY2suX190b29sdGlwcyA9IChvYmosIGFyZ3MsIHJldCwgSWdvcikgPT4ge1xyXG4gICAgbGV0IHdobyA9IElnb3IuZ2V0SWQob2JqKVxyXG4gICAgbGV0IGRhdGEgPSBbXVxyXG4gICAgbGV0IHRpcCA9IFwiXCJcclxuICAgIHN3aXRjaChhcmdzLndoaWNoKSB7XHJcbiAgICAgICAgY2FzZSAnZm91bmRhdGlvbic6XHJcbiAgICAgICAgICAgIGRhdGEucHVzaCh7bmFtZTogXCJpbnNlcnRlclwiLCBjb3VudDogMn0pXHJcbiAgICAgICAgICAgIGRhdGEucHVzaCh7bmFtZTogXCJzdG9uZVwiLCBjb3VudDogNX0pXHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2J1aWxkTGFiJzpcclxuICAgICAgICAgICAgZGF0YS5wdXNoKHtuYW1lOiBcImxhYlwiLCBjb3VudDogMX0pXHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgICByZXQuX3Jlc3VsdCA9IHt0b29sOiBcInN0YWNrQXJyYXlcIiwgdGlwLCBkYXRhfVxyXG59XHJcblRlY2hCbG9jay5fX3Rvb2x0aXBzLklnb3Jfb3BlcmF0aW9uID0gXCJ0ZWNoQmxvY2sudG9vbFRpcHNcIlxyXG5UZWNoQmxvY2suX190b29sdGlwcy5DQ191dGlsaXR5ID0gXCJ0ZWNoQmxvY2sudG9vbFRpcHNcIlxyXG5UZWNoQmxvY2sudGljayA9IChvYmosIHRpY2tEYXRhLCBJZ29yKSA9PiB7XHJcbiAgICBsZXQgcmVzZWFyY2ggPSBJZ29yLmdldE5hbWVkT2JqZWN0KCdyZXNlYXJjaCcpLnByb2dyZXNzaW5nXHJcbiAgICBpZighcmVzZWFyY2gpIHJldHVyblxyXG4gICAgaWYoTnVtYmVyLmlzTmFOKG9iai5yZXNlYXJjaF90aWNrcykgfHwgb2JqLnJlc2VhcmNoX3RpY2tzPT09bnVsbCkge1xyXG4gICAgICAgIGxldCBjb3N0ID0gcmVzZWFyY2guY29zdC5pbmdyZWRpZW50cy5tYXAoKFtuYW1lLCBxdHldKT0+IHtyZXR1cm4ge25hbWUsIGNvdW50OnF0eX19KVxyXG4gICAgICAgIGxldCBjYW5Db25zdW1lID0gSWdvci5wcm9jZXNzVEVNUChvYmouYnVmZmVycy5pbiwgXCJpbnZlbnRvcnkuY29uc3VtZVwiLCB7aXRlbVN0YWNrczogY29zdCwgbXVsdGk6IG9iai5idWlsdH0pXHJcbiAgICAgICAgb2JqLnJlc2VhcmNoX3RpbWUgPSByZXNlYXJjaC5jb3N0LnRpbWUgKiBJZ29yLmdldFN0YXRpYyhcImNvbmZpZy5USUNLU19QRVJfU0VDT05EXCIpICogb2JqLnJlc2VhcmNoX3NwZWVkXHJcbiAgICAgICAgaWYoIWNhbkNvbnN1bWUpIHtcclxuICAgICAgICAgICAgb2JqLnJlc2VhcmNoX2NvbnN1bWVkID0gMFxyXG4gICAgICAgICAgICBvYmoucmVzZWFyY2hfdGlja3MgPSBvYmoucmVzZWFyY2hfdGltZSAqIDAuMVxyXG4gICAgICAgICAgICBvYmouc3RhbGxlZCA9IHRydWVcclxuICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9iai5zdGFsbGVkID0gZmFsc2VcclxuICAgICAgICBvYmoucmVzZWFyY2hfdGlja3MgPSBvYmoucmVzZWFyY2hfdGltZVxyXG4gICAgICAgIG9iai5yZXNlYXJjaF9jb25zdW1lZCA9IGNhbkNvbnN1bWVcclxuICAgIH0gZWxzZSBpZihvYmoucmVzZWFyY2hfdGlja3MpIHtcclxuICAgICAgICAtLW9iai5yZXNlYXJjaF90aWNrc1xyXG4gICAgfSBlbHNlIGlmKG9iai5yZXNlYXJjaF90aWNrczw9MCkge1xyXG4gICAgICAgIGlmKG9iai5yZXNlYXJjaF9jb25zdW1lZCkge1xyXG4gICAgICAgICAgICBsZXQgcmV0ID0gSWdvci5wcm9jZXNzVEVNUChyZXNlYXJjaCwgXCJyZXNlYXJjaC51cGRhdGVcIiwge2NvdW50OiBvYmoucmVzZWFyY2hfY29uc3VtZWQsIG1lOiBvYmouJF9pZH0pXHJcbiAgICAgICAgICAgIGxldCBjb3N0ID0gcmVzZWFyY2guY29zdC5pbmdyZWRpZW50cy5tYXAoKFtuYW1lLCBxdHldKT0+IHtyZXR1cm4ge25hbWUsIGNvdW50OnF0eX19KVxyXG4gICAgICAgICAgICBJZ29yLnByb2Nlc3NURU1QKG9iai5idWZmZXJzLmluLCBcImludmVudG9yeS5hZGRcIiwge2l0ZW1TdGFja3M6IGNvc3QsIGZvcmNlOiB0cnVlLCBtdWx0aTogcmV0fSlcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9iai5yZXNlYXJjaF90aWNrcyA9IE5hTlxyXG4gICAgfVxyXG5cclxufVxyXG5cclxuSWdvckpzLmRlZmluZU9iaihcIlRlY2hCbG9ja1wiLCBUZWNoQmxvY2suTmV3LCBUZWNoQmxvY2spIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFGQTtBQUdBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUF2QkE7QUFDQTtBQXdCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUdBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFEQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBQ0E7QUFRQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUVBOzs7O0FBR0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBRUE7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFHQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQUtBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBOzs7Ozs7OztBQVNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFsQkE7QUFDQTtBQW1CQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQURBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFJQTs7OztBQUlBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQURBO0FBSUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQUE7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFUQTtBQUNBO0FBVUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///v3/l\n");

/***/ })

}]);